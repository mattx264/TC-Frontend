!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){function e(e,t){var n=this;this.addKeyDownEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);13==e.keyCode&&(e.preventDefault(),n.sendMessage({action:"sendKeys",path:o,value:"Keys.ENTER"}),setTimeout((function(){document.querySelector("form").submit()}),100))},this.addKeyUpEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);if("tab"!=e.code.toLowerCase()&&"shiftleft"!=e.code.toLowerCase()&&"shiftright"!=e.code.toLowerCase()&&"backspace"!=e.code.toLowerCase()&&"controlright"!=e.code.toLowerCase()&&"controlleft"!=e.code.toLowerCase()&&"altright"!=e.code.toLowerCase()&&"altleft"!=e.code.toLowerCase()){if(13!=e.keyCode)if("Backspace"===e.code)n.sendMessage({action:"sendKeys",path:o,value:"Keys.BACKSPACE"});else if(t instanceof HTMLInputElement){"/HTML"===(o=n.xpathHelper.getActionElementXPath(t))&&(o=n.xpathHelper.getElementXPath(t));var a={action:"sendKeys",path:o,value:e.key};n.sendMessage(a)}}else n.sendMessage({action:"sendKeys",path:o,value:"Keys."+e.code.toUpperCase()})},this.addClickEventListener=function(e){n.checkAndMonitorSelectElement(e.target);var t=n.xpathHelper.getActionElementXPath(e.target);if("/HTML"===t&&(t=n.xpathHelper.getElementXPath(e.target)),null!==t){var o={action:"click",path:t,value:null};n.sendMessage(o)}},this.addDoubleClickEventListener=function(e){console.log("double click!!!"),console.log(e)},this.addRightMouseListener=function(e){3!==e.which&&n.addClickEventListener(e),n.rightClickElementClicked=e.target,n.rightClickElementClicked.classList.add("tc-selected-element")},this.onChangeSelect=function(e){var t=n.xpathHelper.getElementXPath(e.target,document);n.sendMessage({value:e.target.value,action:"selectByValue",path:t})},this.xpathHelper=e,this.sendMessage=t,document.addEventListener("mousedown",this.addRightMouseListener),document.addEventListener("keyup",this.addKeyUpEventListener),document.addEventListener("keydown",this.addKeyDownEventListener),document.addEventListener("dblclick",this.addDoubleClickEventListener)}return e.prototype.checkAndMonitorSelectElement=function(e){"SELECT"===e.nodeName&&e.addEventListener("change",this.onChangeSelect)},e}(),a=function(){function e(){}return e.prototype.getXPath=function(e){if(e.hasAttribute("id"))return"//"+e.tagName+'[@id="'+e.id+'"]';if(e.hasAttribute("class"))return"//"+e.tagName+'[@class="'+e.getAttribute("class")+'"]';var t="/"+e.tagName;return this.getXPath(e.parentNode)+t},e.prototype.getElementXPath=function(e,t){void 0===t&&(t=void 0),null==t&&(t=document);for(var n,o,a="";e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;a=e.nodeName+"["+n+"]/"+a,e=e.parentNode}return a=(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementXPathByType=function(e,t,n){void 0===t&&(t=void 0),void 0===n&&(n="INPUT");e.cloneNode(!0);null==t&&(t=document);for(var o,a,r="",i=!0;e!==t.documentElement;){for(o=0,a=e;a;)1===a.nodeType&&a.nodeName===e.nodeName&&(o+=1),a=a.previousSibling;if(!0===i&&e&&e.nodeName==n?(r=e.nodeName+"["+o+"]/"+r,i=!1):!1===i&&(r=e.nodeName+"["+o+"]/"+r),!e)break;e=e.parentNode}return r=(r="/"+t.documentElement.nodeName+"/"+r).replace(/\/$/,"")},e.prototype.getInputElementXPath=function(e,t){return void 0===t&&(t=void 0),this.getElementXPathByType(e,t,"INPUT")},e.prototype.getActionElementXPath=function(e,t){void 0===t&&(t=void 0);e.cloneNode(!0);null==t&&(t=document);for(var n,o,a="",r=!0;e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;if(!0!==r||!e||"A"!=e.nodeName&&"BUTTON"!=e.nodeName&&"SELECT"!=e.nodeName?!1===r&&(a=e.nodeName+"["+n+"]/"+a):(a=e.nodeName+"["+n+"]/"+a,r=!1),!e)break;e=e.parentNode}return a=(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementByXPath=function(e,t){if(t||(t=document),t.evaluate)return t.evaluate(e,document,null,9,null).singleNodeValue;for(;"/"==e.charAt(0);)e=e.substr(1);for(var n=t,o=e.split("/"),a=0;a<o.length;a++){var r=o[a].split(/(\w*)\[(\d*)\]/gi).filter((function(e){return!(""==e||e.match(/\s/gi))}),this),i=r[0],s=r[1]?r[1]-1:0;if(!(a<o.length-1))return n.getElementsByTagName(i)[s];n=n.getElementsByTagName(i)[s]}},e.prototype.getElementByXPathCount=function(e,t){t||(t=document),document.evaluate("count("+e+")",t,null,XPathResult.ANY_TYPE,null)},e}(),r=function(){function e(){}return e.prototype.startMonitor=function(e){chrome.extension.connect({name:"Sample Communication"}).onMessage.addListener((function(t){"xhrStart"===t.type?e({action:t.type,value:[t.data.url,t.data.method],xhrObject:t,path:null}):"xhrDone"===t.type&&e({action:t.type,value:[t.data.url,t.data.method,t.data.statusCode],xhrObject:t,path:null})}))},e}();new(function(){function e(){var e=this;this.actionLog=[],this.isInit={startBrowserActionMonitor:!1,startXHRMonitor:!1},"true"===localStorage.getItem("isStart")&&this.sendMessageToPopup({type:"getInfo",data:{action:"isStarted"}},(function(e){!0!==e&&localStorage.setItem("isStart","false")})),0==chrome.runtime.onMessage.hasListener((function(e,t,n){}))&&chrome.runtime.onMessage.addListener((function(t,n,o){switch(t.method){case"getUrl":e.sendMessage({action:"goToUrl",value:location.href,path:null});break;case"startBrowserActionMonitor":localStorage.setItem("isStart","true"),e.startBrowserActionMonitor();break;case"startXHRMonitor":e.startXHRMonitor();break;default:throw new Error("Message method not support - add new case "+t.method)}o({successful:!0})})),this.sendMessageToPopup({type:"hello"})}return e.prototype.sendMessage=function(e){if(chrome.runtime){if(this.actionLog.length>0){var t=this.actionLog[this.actionLog.length-1];if(t.path===e.path&&"sendKeys"===t.action&&null!==e.value&&-1===e.value.indexOf("Keys."))return void this.sendUpdateMessage(e)}this.actionLog.push(e),this.sendMessageToPopup({type:"insert",data:e})}},e.prototype.sendUpdateMessage=function(e){this.sendMessageToPopup({type:"appendLastValue",data:e})},e.prototype.sendMessageToPopup=function(e,t){chrome.runtime&&chrome.runtime.sendMessage(e,(function(e){console.log(e),t(e)}))},e.prototype.startXHRMonitor=function(){!0!==this.isInit.startXHRMonitor&&(this.isInit.startXHRMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),(new r).startMonitor(this.sendMessage.bind(this)))},e.prototype.startBrowserActionMonitor=function(){!0!==this.isInit.startBrowserActionMonitor&&(this.isInit.startBrowserActionMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),this.xpathHelper=new a,new o(this.xpathHelper,this.sendMessage.bind(this)))},e}())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jyb3dzZXJBY3Rpb25Nb25pdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy94cGF0aEhlbHBlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvcmVxdWVzdE1vbml0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwieHBhdGhIZWxwZXIiLCJzZW5kTWVzc2FnZSIsImFkZEtleURvd25FdmVudExpc3RlbmVyIiwiZSIsImFjdGl2ZUVsZW1lbnQiLCJkb2N1bWVudCIsInhwYXRoIiwiZ2V0SW5wdXRFbGVtZW50WFBhdGgiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJhY3Rpb24iLCJwYXRoIiwic2V0VGltZW91dCIsInF1ZXJ5U2VsZWN0b3IiLCJzdWJtaXQiLCJhZGRLZXlVcEV2ZW50TGlzdGVuZXIiLCJjb2RlIiwidG9Mb3dlckNhc2UiLCJIVE1MSW5wdXRFbGVtZW50IiwiZ2V0QWN0aW9uRWxlbWVudFhQYXRoIiwiZ2V0RWxlbWVudFhQYXRoIiwiZGF0YSIsInRvVXBwZXJDYXNlIiwiYWRkQ2xpY2tFdmVudExpc3RlbmVyIiwiY2hlY2tBbmRNb25pdG9yU2VsZWN0RWxlbWVudCIsInRhcmdldCIsImFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lciIsImNvbnNvbGUiLCJsb2ciLCJhZGRSaWdodE1vdXNlTGlzdGVuZXIiLCJ3aGljaCIsInJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZCIsImNsYXNzTGlzdCIsImFkZCIsIm9uQ2hhbmdlU2VsZWN0IiwiZXZlbnQiLCJ0aGlzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImVsZW1lbnQiLCJub2RlTmFtZSIsImdldFhQYXRoIiwibm9kZSIsImhhc0F0dHJpYnV0ZSIsInRhZ05hbWUiLCJpZCIsImdldEF0dHJpYnV0ZSIsIm9sZCIsInBhcmVudE5vZGUiLCJkb2MiLCJ1bmRlZmluZWQiLCJwb3MiLCJ0ZW1waXRlbTIiLCJkb2N1bWVudEVsZW1lbnQiLCJub2RlVHlwZSIsInByZXZpb3VzU2libGluZyIsInJlcGxhY2UiLCJnZXRFbGVtZW50WFBhdGhCeVR5cGUiLCJ0eXBlIiwiY2xvbmVOb2RlIiwiaXNGaXJzdCIsImdldEVsZW1lbnRCeVhQYXRoIiwieFBhdGgiLCJldmFsdWF0ZSIsInNpbmdsZU5vZGVWYWx1ZSIsImNoYXJBdCIsInN1YnN0ciIsInByZXZFbGVtIiwiYXJyIiwic3BsaXQiLCJsZW5ndGgiLCJzdGVwIiwiZmlsdGVyIiwidiIsIm1hdGNoIiwiZWxlbSIsImVsZW1OdW0iLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeVhQYXRoQ291bnQiLCJYUGF0aFJlc3VsdCIsIkFOWV9UWVBFIiwic3RhcnRNb25pdG9yIiwiY2hyb21lIiwiZXh0ZW5zaW9uIiwiY29ubmVjdCIsIm9uTWVzc2FnZSIsImFkZExpc3RlbmVyIiwibXNnIiwidXJsIiwibWV0aG9kIiwieGhyT2JqZWN0Iiwic3RhdHVzQ29kZSIsImFjdGlvbkxvZyIsImlzSW5pdCIsInN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IiLCJzdGFydFhIUk1vbml0b3IiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2VuZE1lc3NhZ2VUb1BvcHVwIiwicmVzcG9uc2UiLCJzZXRJdGVtIiwicnVudGltZSIsImhhc0xpc3RlbmVyIiwibWVzc2FnZSIsInNlbmRlciIsInNlbmRSZXNwb25zZSIsImxvY2F0aW9uIiwiaHJlZiIsIkVycm9yIiwic3VjY2Vzc2Z1bCIsInByZXYiLCJpbmRleE9mIiwic2VuZFVwZGF0ZU1lc3NhZ2UiLCJwdXNoIiwiY2FsbEJhY2siLCJKU09OIiwic3RyaW5naWZ5IiwiUmVxdWVzdGlvbk1vbml0b3IiLCJYcGF0aEhlbHBlciIsIkJyb3dzZXJBY3Rpb25Nb25pdG9yIl0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxF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QVlxRyxHQUFTLFNBQVVKLEdBQzFDdkUsUUFBUUMsSUFBSXNFLEdBQ1plLEVBQVNmLE9BTWIsWUFBQUosZ0JBQVIsWUFDd0MsSUFBaEMxRCxLQUFLd0QsT0FBT0Usa0JBR2hCMUQsS0FBS3dELE9BQU9FLGlCQUFrQixFQUM5QkMsYUFBYUksUUFBUSxTQUFVZSxLQUFLQyxVQUFVL0UsS0FBS3dELFVBQ25ELElBQUl3QixHQUFvQnBDLGFBQWE1QyxLQUFLbkMsWUFBWVQsS0FBSzRDLFNBRXZELFlBQUF5RCwwQkFBUixZQUNrRCxJQUExQ3pELEtBQUt3RCxPQUFPQyw0QkFHaEJ6RCxLQUFLd0QsT0FBT0MsMkJBQTRCLEVBQ3hDRSxhQUFhSSxRQUFRLFNBQVVlLEtBQUtDLFVBQVUvRSxLQUFLd0QsU0FDbkR4RCxLQUFLcEMsWUFBYyxJQUFJcUgsRUFHdkIsSUFBSUMsRUFBcUJsRixLQUFLcEMsWUFBYW9DLEtBQUtuQyxZQUFZVCxLQUFLNEMsU0FHekUsRUFsR0EiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IHsgT3BlcmF0b3JNb2RlbCB9IGZyb20gXCIuLi8uLi9zaGFyZWQvc3JjL2xpYi9tb2RlbHMvb3BlcmF0b3JNb2RlbFwiO1xyXG5pbXBvcnQgeyBYcGF0aEhlbHBlciB9IGZyb20gXCIuL3hwYXRoSGVscGVyXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQnJvd3NlckFjdGlvbk1vbml0b3Ige1xyXG4gICAgeHBhdGhIZWxwZXI6IFhwYXRoSGVscGVyO1xyXG4gICAgcmlnaHRDbGlja0VsZW1lbnRDbGlja2VkOiBhbnk7XHJcbiAgICBzZW5kTWVzc2FnZTogRnVuY3Rpb247XHJcbiAgICBjb25zdHJ1Y3Rvcih4cGF0aEhlbHBlcjpYcGF0aEhlbHBlcixzZW5kTWVzc2FnZTpGdW5jdGlvbil7XHJcbiAgICAgICAgdGhpcy54cGF0aEhlbHBlcj14cGF0aEhlbHBlcjtcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlPXNlbmRNZXNzYWdlO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5hZGRSaWdodE1vdXNlTGlzdGVuZXIpO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5hZGRLZXlVcEV2ZW50TGlzdGVuZXIpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuYWRkS2V5RG93bkV2ZW50TGlzdGVuZXIpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCB0aGlzLmFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lcik7XHJcbiAgICB9XHJcbiAgICBhZGRLZXlEb3duRXZlbnRMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldElucHV0RWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7Ly9FTlRFUiBcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy5FTlRFUidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL1RPRE8gY2hlY2sgaWYgb2JqZWN0ICdlJyBjYW4gYmUgcmVzdWJtaXRlZC4gLSBpc3N1ZSBjYW4gYmUgd2hlbiB5b3UgaGF2ZSBtb3JlIHRoYW4gMSBmb3JtXHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtJykuc3VibWl0KCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGFkZEtleVVwRXZlbnRMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldElucHV0RWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIGlmIChlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcInRhYlwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwic2hpZnRsZWZ0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJzaGlmdHJpZ2h0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCk9PSdiYWNrc3BhY2UnXHJcbiAgICAgICAgICAgIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiY29udHJvbHJpZ2h0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJjb250cm9sbGVmdFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiYWx0cmlnaHRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcImFsdGxlZnRcIikge1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy4nICsgZS5jb2RlLnRvVXBwZXJDYXNlKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAxMykge1xyXG4gICAgICAgICAgICAvL0VOVEVSIGlzIGhhbmRsZXIgaW4gYWRkS2V5RG93bkV2ZW50TGlzdGVuZXJcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZS5jb2RlID09PSBcIkJhY2tzcGFjZVwiKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy5CQUNLU1BBQ0UnXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChhY3RpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRBY3Rpb25FbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIGlmICh4cGF0aCA9PT0gJy9IVE1MJykge1xyXG4gICAgICAgICAgICAgICAgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEVsZW1lbnRYUGF0aChhY3RpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHsgYWN0aW9uOiAnc2VuZEtleXMnLCBwYXRoOiB4cGF0aCwgdmFsdWU6IGUua2V5IH07XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYWRkQ2xpY2tFdmVudExpc3RlbmVyID0gKGU6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5jaGVja0FuZE1vbml0b3JTZWxlY3RFbGVtZW50KGUudGFyZ2V0KTtcclxuICAgICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEFjdGlvbkVsZW1lbnRYUGF0aChlLnRhcmdldCBhcyBOb2RlKTtcclxuICAgICAgICBpZiAoeHBhdGggPT09ICcvSFRNTCcpIHtcclxuICAgICAgICAgICAgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEVsZW1lbnRYUGF0aChlLnRhcmdldCBhcyBOb2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHhwYXRoID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGRhdGE6IE9wZXJhdG9yTW9kZWwgPSB7IGFjdGlvbjogJ2NsaWNrJywgcGF0aDogeHBhdGgsIHZhbHVlOiBudWxsIH1cclxuICAgICAgICAvL3ZhciBkYXRhID0geyBhY3Rpb246ICdjbGljaycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogbnVsbCB9XHJcbiAgICAgICAgLy90aGlzLnRlbXBFdmVudEVsZW1lbnQgPSB0aGlzLnhwYXRoSGVscGVyLmdldEVsZW1lbnRCeVhQYXRoKHhwYXRoLCBkb2N1bWVudCk7XHJcblxyXG5cclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKGRhdGEpO1xyXG4gICAgfVxyXG4gICAgYWRkRG91YmxlQ2xpY2tFdmVudExpc3RlbmVyID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImRvdWJsZSBjbGljayEhIVwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhlKVxyXG4gICAgfVxyXG4gICAgYWRkUmlnaHRNb3VzZUxpc3RlbmVyID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICBpZiAoZS53aGljaCAhPT0gMykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZENsaWNrRXZlbnRMaXN0ZW5lcihlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yaWdodENsaWNrRWxlbWVudENsaWNrZWQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICB0aGlzLnJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZC5jbGFzc0xpc3QuYWRkKFwidGMtc2VsZWN0ZWQtZWxlbWVudFwiKTtcclxuICAgICAgICAvL3JpZ2h0IGNsaWNrIFxyXG4gICAgfVxyXG4gICAgY2hlY2tBbmRNb25pdG9yU2VsZWN0RWxlbWVudChlbGVtZW50OiBhbnkpIHtcclxuICAgICAgICBpZiAoZWxlbWVudC5ub2RlTmFtZSAhPT0gXCJTRUxFQ1RcIikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25DaGFuZ2VTZWxlY3QpO1xyXG4gICAgfVxyXG4gICAgb25DaGFuZ2VTZWxlY3QgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0RWxlbWVudFhQYXRoKGV2ZW50LnRhcmdldCwgZG9jdW1lbnQpO1xyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoeyB2YWx1ZTogZXZlbnQudGFyZ2V0LnZhbHVlLCBhY3Rpb246ICdzZWxlY3RCeVZhbHVlJywgcGF0aDogeHBhdGggfSk7XHJcblxyXG4gICAgfVxyXG59IiwiZXhwb3J0IGNsYXNzIFhwYXRoSGVscGVyIHtcclxuICAgIFxyXG4gICAgZ2V0WFBhdGgobm9kZTogYW55KTogc3RyaW5nIHtcclxuICAgICAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJy8vJyArIG5vZGUudGFnTmFtZSArICdbQGlkPVwiJyArIG5vZGUuaWQgKyAnXCJdJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShcImNsYXNzXCIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnLy8nICsgbm9kZS50YWdOYW1lICsgJ1tAY2xhc3M9XCInICsgbm9kZS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSArICdcIl0nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIG9sZCA9ICcvJyArIG5vZGUudGFnTmFtZTtcclxuICAgICAgICBsZXQgbmV3X3BhdGggPSB0aGlzLmdldFhQYXRoKG5vZGUucGFyZW50Tm9kZSkgKyBvbGQ7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdfcGF0aDtcclxuICAgIH1cclxuICAgIGdldEVsZW1lbnRYUGF0aChub2RlOiBOb2RlIHwgbnVsbCwgZG9jOiBEb2N1bWVudCA9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGlmIChkb2MgPT0gdW5kZWZpbmVkKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSAnJztcclxuICAgICAgICB2YXIgcG9zLCB0ZW1waXRlbTI7XHJcbiAgICAgICAgd2hpbGUgKG5vZGUgIT09IGRvYy5kb2N1bWVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcG9zID0gMDsgdGVtcGl0ZW0yID0gbm9kZTtcclxuICAgICAgICAgICAgd2hpbGUgKHRlbXBpdGVtMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBpdGVtMi5ub2RlVHlwZSA9PT0gMSAmJiB0ZW1waXRlbTIubm9kZU5hbWUgPT09IG5vZGUhLm5vZGVOYW1lKSB7IHBvcyArPSAxOyB9XHJcbiAgICAgICAgICAgICAgICB0ZW1waXRlbTIgPSB0ZW1waXRlbTIucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHhwYXRoID0gbm9kZSEubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgbm9kZSA9IG5vZGUhLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhwYXRoID0gJy8nICsgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSArICcvJyArIHhwYXRoO1xyXG4gICAgICAgIHhwYXRoID0geHBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuICAgICAgICByZXR1cm4geHBhdGg7XHJcbiAgICB9XHJcbiAgICBnZXRFbGVtZW50WFBhdGhCeVR5cGUobm9kZTogTm9kZSB8IG51bGwsIGRvYzogRG9jdW1lbnQgPSB1bmRlZmluZWQsIHR5cGU6IHN0cmluZz0nSU5QVVQnKSB7XHJcbiAgICAgICAgdmFyIG5vZGVDbG9uZSA9IG5vZGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgIGlmIChkb2MgPT0gdW5kZWZpbmVkKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSAnJztcclxuICAgICAgICB2YXIgaXNGaXJzdCA9IHRydWU7XHJcbiAgICAgICAgdmFyIHBvcywgdGVtcGl0ZW0yO1xyXG4gICAgICAgIHdoaWxlIChub2RlICE9PSBkb2MuZG9jdW1lbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHBvcyA9IDA7IHRlbXBpdGVtMiA9IG5vZGU7XHJcbiAgICAgICAgICAgIHdoaWxlICh0ZW1waXRlbTIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1waXRlbTIubm9kZVR5cGUgPT09IDEgJiYgdGVtcGl0ZW0yLm5vZGVOYW1lID09PSBub2RlLm5vZGVOYW1lKSB7IHBvcyArPSAxOyB9XHJcbiAgICAgICAgICAgICAgICB0ZW1waXRlbTIgPSB0ZW1waXRlbTIucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc0ZpcnN0ID09PSB0cnVlICYmIG5vZGUgJiYgKG5vZGUubm9kZU5hbWUgPT0gdHlwZSkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgICAgIC8vIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgb3BlblNlbGVjdE9wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIC8vcmV0dXJuIG51bGw7IC0+IHJldHVybiBudWxsIGlzIGJhZCBpZGVhIGJlY2F1c2UgaXQgd2lsbCBcclxuICAgICAgICAgICAgICAgIC8vIH0gZWxzZSBpZiAobm9kZS5ub2RlTmFtZSA9PSAnU0VMRUNUJyAmJiBvcGVuU2VsZWN0T3BlbiA9PT0gdHJ1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ZpcnN0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgeHBhdGggPSBub2RlLm5vZGVOYW1lICsgJ1snICsgcG9zICsgJ10nICsgJy8nICsgeHBhdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB4cGF0aCA9ICcvJyArIGRvYy5kb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICB4cGF0aCA9IHhwYXRoLnJlcGxhY2UoL1xcLyQvLCAnJyk7XHJcbiAgICAgICAgLy8gaWYoeHBhdGg9PT0nL0hUTUwnKXtcclxuICAgICAgICAvLyAgICAgdmFyIHJldFZhbCA9Y29uZmlybShcIkVsZW1lbnQgaXMgbm90IGFjdGlvbiBlbGVtZW50LCBkbyB5b3Ugd2FudCB0byBnZXQgbm90IGFjdGl2ZSBlbGVtZW50P1wiKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIGlmKCByZXRWYWwgPT0gdHJ1ZSApIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEVsZW1lbnRYUGF0aChub2RlQ2xvbmUsZG9jKTtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgIC8vIFx0XHRcdCAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIC8vIFx0XHQgICB9XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiB4cGF0aDtcclxuICAgIH1cclxuICAgIGdldElucHV0RWxlbWVudFhQYXRoKG5vZGU6IE5vZGUgfCBudWxsLCBkb2M6IERvY3VtZW50ID0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudFhQYXRoQnlUeXBlKG5vZGUsZG9jLFwiSU5QVVRcIik7XHJcbiAgICB9XHJcbiAgICBnZXRBY3Rpb25FbGVtZW50WFBhdGgobm9kZTogTm9kZSB8IG51bGwsIGRvYzogRG9jdW1lbnQgPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgdmFyIG5vZGVDbG9uZSA9IG5vZGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgIGlmIChkb2MgPT0gdW5kZWZpbmVkKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSAnJztcclxuICAgICAgICB2YXIgaXNGaXJzdCA9IHRydWU7XHJcbiAgICAgICAgdmFyIHBvcywgdGVtcGl0ZW0yO1xyXG4gICAgICAgIHdoaWxlIChub2RlICE9PSBkb2MuZG9jdW1lbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHBvcyA9IDA7IHRlbXBpdGVtMiA9IG5vZGU7XHJcbiAgICAgICAgICAgIHdoaWxlICh0ZW1waXRlbTIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1waXRlbTIubm9kZVR5cGUgPT09IDEgJiYgdGVtcGl0ZW0yLm5vZGVOYW1lID09PSBub2RlLm5vZGVOYW1lKSB7IHBvcyArPSAxOyB9XHJcbiAgICAgICAgICAgICAgICB0ZW1waXRlbTIgPSB0ZW1waXRlbTIucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc0ZpcnN0ID09PSB0cnVlICYmIG5vZGUgJiYgKG5vZGUubm9kZU5hbWUgPT0gJ0EnIHx8IG5vZGUubm9kZU5hbWUgPT0gJ0JVVFRPTicgfHwgbm9kZS5ub2RlTmFtZSA9PSAnU0VMRUNUJykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgICAgIC8vIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgb3BlblNlbGVjdE9wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIC8vcmV0dXJuIG51bGw7IC0+IHJldHVybiBudWxsIGlzIGJhZCBpZGVhIGJlY2F1c2UgaXQgd2lsbCBcclxuICAgICAgICAgICAgICAgIC8vIH0gZWxzZSBpZiAobm9kZS5ub2RlTmFtZSA9PSAnU0VMRUNUJyAmJiBvcGVuU2VsZWN0T3BlbiA9PT0gdHJ1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ZpcnN0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgeHBhdGggPSBub2RlLm5vZGVOYW1lICsgJ1snICsgcG9zICsgJ10nICsgJy8nICsgeHBhdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB4cGF0aCA9ICcvJyArIGRvYy5kb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICB4cGF0aCA9IHhwYXRoLnJlcGxhY2UoL1xcLyQvLCAnJyk7XHJcbiAgICAgICAgLy8gaWYoeHBhdGg9PT0nL0hUTUwnKXtcclxuICAgICAgICAvLyAgICAgdmFyIHJldFZhbCA9Y29uZmlybShcIkVsZW1lbnQgaXMgbm90IGFjdGlvbiBlbGVtZW50LCBkbyB5b3Ugd2FudCB0byBnZXQgbm90IGFjdGl2ZSBlbGVtZW50P1wiKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIGlmKCByZXRWYWwgPT0gdHJ1ZSApIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEVsZW1lbnRYUGF0aChub2RlQ2xvbmUsZG9jKTtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgIC8vIFx0XHRcdCAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIC8vIFx0XHQgICB9XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiB4cGF0aDtcclxuICAgIH1cclxuICAgIGdldEVsZW1lbnRCeVhQYXRoKHhQYXRoOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQpOiBhbnkge1xyXG4gICAgICAgIGlmICghZG9jKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICBpZiAoZG9jLmV2YWx1YXRlKSByZXR1cm4gZG9jLmV2YWx1YXRlKHhQYXRoLCBkb2N1bWVudCwgbnVsbCwgOSwgbnVsbCkuc2luZ2xlTm9kZVZhbHVlO1xyXG4gICAgICAgIC8vIGZvciBJRVxyXG4gICAgICAgIHdoaWxlICh4UGF0aC5jaGFyQXQoMCkgPT0gJy8nKSB4UGF0aCA9IHhQYXRoLnN1YnN0cigxKTtcclxuICAgICAgICB2YXIgcHJldkVsZW0gPSBkb2M7XHJcbiAgICAgICAgdmFyIGFyciA9IHhQYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHN0ZXA6IGFueSA9IGFycltpXS5zcGxpdCgvKFxcdyopXFxbKFxcZCopXFxdL2dpKS5maWx0ZXIoKHYpID0+IHsgcmV0dXJuICEodiA9PSAnJyB8fCB2Lm1hdGNoKC9cXHMvZ2kpKSB9LCB0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGVsZW0gPSBzdGVwWzBdO1xyXG4gICAgICAgICAgICB2YXIgZWxlbU51bSA9IHN0ZXBbMV0gPyBzdGVwWzFdIC0gMSA6IDA7IC8vIC0xIHNpbmNlIHhwYXRoIGlzIDEgYmFzZWRcclxuICAgICAgICAgICAgaWYgKGkgPCBhcnIubGVuZ3RoIC0gMSkgcHJldkVsZW0gPSBwcmV2RWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZShlbGVtKVtlbGVtTnVtXTtcclxuICAgICAgICAgICAgZWxzZSByZXR1cm4gcHJldkVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoZWxlbSlbZWxlbU51bV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0RWxlbWVudEJ5WFBhdGhDb3VudCh4UGF0aDogc3RyaW5nLCBkb2M6IERvY3VtZW50KSB7XHJcbiAgICAgICAgaWYgKCFkb2MpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIGRvY3VtZW50LmV2YWx1YXRlKFwiY291bnQoXCIgKyB4UGF0aCArIFwiKVwiLCBkb2MsIG51bGwsIFhQYXRoUmVzdWx0LkFOWV9UWVBFLCBudWxsKTtcclxuICAgIH1cclxufSIsIlxyXG5leHBvcnQgY2xhc3MgUmVxdWVzdGlvbk1vbml0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgfVxyXG4gICAgc3RhcnRNb25pdG9yKHNlbmRNZXNzYWdlKSB7XHJcblxyXG4gICAgICAgIHZhciBwb3J0ID0gKDxhbnk+Y2hyb21lKS5leHRlbnNpb24uY29ubmVjdCh7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiU2FtcGxlIENvbW11bmljYXRpb25cIlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBwb3J0Lm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3hoclN0YXJ0Jykge1xyXG4gICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogbXNnLnR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFttc2cuZGF0YS51cmwsIG1zZy5kYXRhLm1ldGhvZF0sXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyT2JqZWN0Om1zZyxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChtc2cudHlwZSA9PT0gJ3hockRvbmUnKSB7XHJcbiAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBtc2cudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW21zZy5kYXRhLnVybCwgbXNnLmRhdGEubWV0aG9kLCBtc2cuZGF0YS5zdGF0dXNDb2RlXSxcclxuICAgICAgICAgICAgICAgICAgICB4aHJPYmplY3Q6bXNnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IG51bGxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQge01haW59IGZyb20gJy4vbWFpbic7XHJcbm5ldyBNYWluKCk7XHJcblxyXG4iLCJpbXBvcnQgeyBPcGVyYXRvck1vZGVsIH0gZnJvbSBcIi4uLy4uL3NoYXJlZC9zcmMvbGliL21vZGVscy9vcGVyYXRvck1vZGVsXCI7XHJcbmltcG9ydCB7IEJyb3dzZXJBY3Rpb25Nb25pdG9yIH0gZnJvbSBcIi4vYnJvd3NlckFjdGlvbk1vbml0b3JcIjtcclxuaW1wb3J0IHsgWHBhdGhIZWxwZXIgfSBmcm9tIFwiLi94cGF0aEhlbHBlclwiO1xyXG5pbXBvcnQgeyBSZXF1ZXN0aW9uTW9uaXRvciB9IGZyb20gXCIuL3JlcXVlc3RNb25pdG9yXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTWFpbiB7XHJcbiAgICB4cGF0aEhlbHBlcjogWHBhdGhIZWxwZXI7XHJcbiAgICAvLyB0ZW1wRXZlbnRFbGVtZW50OiBIVE1MRWxlbWVudDtcclxuICAgIHRlbXBFbGVtZW50VmFsdWU6IHN0cmluZztcclxuICAgIHJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZDogSFRNTEVsZW1lbnQ7XHJcbiAgICBhY3Rpb25Mb2c6IE9wZXJhdG9yTW9kZWxbXSA9IFtdO1xyXG5cclxuICAgIGlzSW5pdDogeyBzdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yLCBzdGFydFhIUk1vbml0b3IgfSA9IHsgc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvcjogZmFsc2UsIHN0YXJ0WEhSTW9uaXRvcjogZmFsc2UgfTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2lzU3RhcnQnKSA9PT0gJ3RydWUnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BvcHVwKHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdnZXRJbmZvJywgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2lzU3RhcnRlZCdcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgIT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaXNTdGFydCcsICdmYWxzZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5oYXNMaXN0ZW5lcigobWVzc2FnZTogYW55LCBzZW5kZXI6IGFueSwgc2VuZFJlc3BvbnNlOiBhbnkpID0+IHsgfSkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlOiBhbnksIHNlbmRlcjogYW55LCBzZW5kUmVzcG9uc2U6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlLm1ldGhvZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dldFVybCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ29Ub1VybCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbG9jYXRpb24uaHJlZixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2lzU3RhcnQnLCAndHJ1ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3RhcnRYSFJNb25pdG9yJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFhIUk1vbml0b3IoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWVzc2FnZSBtZXRob2Qgbm90IHN1cHBvcnQgLSBhZGQgbmV3IGNhc2UgXCIgKyBtZXNzYWdlLm1ldGhvZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKHsgc3VjY2Vzc2Z1bDogdHJ1ZSB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoeyB0eXBlOiAnaGVsbG8nIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbmRNZXNzYWdlKGRhdGE6IE9wZXJhdG9yTW9kZWwpIHtcclxuICAgICAgICBpZiAoIWNocm9tZS5ydW50aW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uTG9nLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuYWN0aW9uTG9nW3RoaXMuYWN0aW9uTG9nLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICBpZiAocHJldi5wYXRoID09PSBkYXRhLnBhdGggJiYgcHJldi5hY3Rpb24gPT09ICdzZW5kS2V5cycgJiYgKGRhdGEudmFsdWUgIT09IG51bGwgJiYgZGF0YS52YWx1ZS5pbmRleE9mKCdLZXlzLicpID09PSAtMSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VuZFVwZGF0ZU1lc3NhZ2UoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hY3Rpb25Mb2cucHVzaChkYXRhKTtcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9Qb3B1cCh7IHR5cGU6ICdpbnNlcnQnLCBkYXRhOiBkYXRhIH0pO1xyXG5cclxuICAgIH1cclxuICAgIHNlbmRVcGRhdGVNZXNzYWdlKGRhdGE6IE9wZXJhdG9yTW9kZWwpIHtcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9Qb3B1cCh7IHR5cGU6ICdhcHBlbmRMYXN0VmFsdWUnLCBkYXRhOiBkYXRhIH0pO1xyXG5cclxuICAgIH1cclxuICAgIHNlbmRNZXNzYWdlVG9Qb3B1cChtZXNzYWdlLCBjYWxsQmFjaz8pIHtcclxuICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUpIHtcclxuICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UobWVzc2FnZSwgZnVuY3Rpb24gKHJlc3BvbnNlOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIGNhbGxCYWNrKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHN0YXJ0WEhSTW9uaXRvcigpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXQuc3RhcnRYSFJNb25pdG9yID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0luaXQuc3RhcnRYSFJNb25pdG9yID0gdHJ1ZTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaXNJbml0JywgSlNPTi5zdHJpbmdpZnkodGhpcy5pc0luaXQpKTtcclxuICAgICAgICBuZXcgUmVxdWVzdGlvbk1vbml0b3IoKS5zdGFydE1vbml0b3IodGhpcy5zZW5kTWVzc2FnZS5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvcigpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXQuc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvciA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNJbml0LnN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IgPSB0cnVlO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc0luaXQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmlzSW5pdCkpO1xyXG4gICAgICAgIHRoaXMueHBhdGhIZWxwZXIgPSBuZXcgWHBhdGhIZWxwZXIoKTtcclxuXHJcblxyXG4gICAgICAgIG5ldyBCcm93c2VyQWN0aW9uTW9uaXRvcih0aGlzLnhwYXRoSGVscGVyLCB0aGlzLnNlbmRNZXNzYWdlLmJpbmQodGhpcykpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==