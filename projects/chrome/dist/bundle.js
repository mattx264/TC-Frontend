!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){function e(e,t){var n=this;this.addKeyDownEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);13==e.keyCode&&(e.preventDefault(),n.sendMessage({action:"sendKeys",path:o,value:"Keys.ENTER"}),setTimeout((function(){document.querySelector("form").submit()}),100))},this.addKeyUpEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);if("tab"!=e.code.toLowerCase()&&"shiftleft"!=e.code.toLowerCase()&&"shiftright"!=e.code.toLowerCase()&&"backspace"!=e.code.toLowerCase()&&"controlright"!=e.code.toLowerCase()&&"controlleft"!=e.code.toLowerCase()&&"altright"!=e.code.toLowerCase()&&"altleft"!=e.code.toLowerCase()){if(13!=e.keyCode)if("Backspace"===e.code)n.sendMessage({action:"sendKeys",path:o,value:"Keys.BACKSPACE"});else if(t instanceof HTMLInputElement){"/HTML"===(o=n.xpathHelper.getActionElementXPath(t))&&(o=n.xpathHelper.getElementXPath(t));var a={action:"sendKeys",path:o,value:e.key};n.sendMessage(a)}}else n.sendMessage({action:"sendKeys",path:o,value:"Keys."+e.code.toUpperCase()})},this.addClickEventListener=function(e){n.checkAndMonitorSelectElement(e.target);var t=n.xpathHelper.getActionElementXPath(e.target);if("/HTML"===t&&(t=n.xpathHelper.getElementXPath(e.target)),null!==t){var o={action:"click",path:t,value:null};n.sendMessage(o)}},this.addDoubleClickEventListener=function(e){console.log("double click!!!"),console.log(e)},this.addMouseListener=function(e){3!==e.which&&n.addClickEventListener(e),n.rightClickElementClicked=e.target,n.rightClickElementClicked.classList.add("tc-selected-element")},this.onChangeSelect=function(e){var t=n.xpathHelper.getElementXPath(e.target,document);n.sendMessage({value:e.target.value,action:"selectByValue",path:t})},this.xpathHelper=e,this.sendMessage=t,null==document.ondblclick&&(document.onkeyup=this.addKeyUpEventListener,document.onkeydown=this.addKeyDownEventListener,document.ondblclick=this.addDoubleClickEventListener,document.onmousedown=this.addMouseListener)}return e.prototype.checkAndMonitorSelectElement=function(e){"SELECT"===e.nodeName&&e.addEventListener("change",this.onChangeSelect)},e}(),a=function(){function e(){}return e.prototype.getXPath=function(e){if(e.hasAttribute("id"))return"//"+e.tagName+'[@id="'+e.id+'"]';if(e.hasAttribute("class"))return"//"+e.tagName+'[@class="'+e.getAttribute("class")+'"]';var t="/"+e.tagName;return this.getXPath(e.parentNode)+t},e.prototype.getElementXPath=function(e,t){void 0===t&&(t=void 0),null==t&&(t=document);for(var n,o,a="";e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;a=e.nodeName+"["+n+"]/"+a,e=e.parentNode}return a=(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementXPathByType=function(e,t,n){void 0===t&&(t=void 0),void 0===n&&(n="INPUT");e.cloneNode(!0);null==t&&(t=document);for(var o,a,i="",r=!0;e!==t.documentElement;){for(o=0,a=e;a;)1===a.nodeType&&a.nodeName===e.nodeName&&(o+=1),a=a.previousSibling;if(!0===r&&e&&e.nodeName==n?(i=e.nodeName+"["+o+"]/"+i,r=!1):!1===r&&(i=e.nodeName+"["+o+"]/"+i),!e)break;e=e.parentNode}return i=(i="/"+t.documentElement.nodeName+"/"+i).replace(/\/$/,"")},e.prototype.getInputElementXPath=function(e,t){return void 0===t&&(t=void 0),this.getElementXPathByType(e,t,"INPUT")},e.prototype.getActionElementXPath=function(e,t){void 0===t&&(t=void 0);e.cloneNode(!0);null==t&&(t=document);for(var n,o,a="",i=!0;e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;if(!0!==i||!e||"A"!=e.nodeName&&"BUTTON"!=e.nodeName&&"SELECT"!=e.nodeName?!1===i&&(a=e.nodeName+"["+n+"]/"+a):(a=e.nodeName+"["+n+"]/"+a,i=!1),!e)break;e=e.parentNode}return a=(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementByXPath=function(e,t){if(t||(t=document),t.evaluate)return t.evaluate(e,document,null,9,null).singleNodeValue;for(;"/"==e.charAt(0);)e=e.substr(1);for(var n=t,o=e.split("/"),a=0;a<o.length;a++){var i=o[a].split(/(\w*)\[(\d*)\]/gi).filter((function(e){return!(""==e||e.match(/\s/gi))}),this),r=i[0],s=i[1]?i[1]-1:0;if(!(a<o.length-1))return n.getElementsByTagName(r)[s];n=n.getElementsByTagName(r)[s]}},e.prototype.getElementByXPathCount=function(e,t){t||(t=document),document.evaluate("count("+e+")",t,null,XPathResult.ANY_TYPE,null)},e}(),i=function(){function e(){}return e.prototype.startMonitor=function(e){chrome.extension.connect({name:"Sample Communication"}).onMessage.addListener((function(t){"xhrStart"===t.type?e({action:t.type,value:[t.data.url,t.data.method],xhrObject:t,path:null}):"xhrDone"===t.type&&e({action:t.type,value:[t.data.url,t.data.method,t.data.statusCode],xhrObject:t,path:null})}))},e}();new(function(){function e(){this.actionLog=[],this.isInit={startBrowserActionMonitor:!1,startXHRMonitor:!1},"true"===localStorage.getItem("isStart")&&this.sendMessageToPopup({type:"getInfo",data:{action:"isStarted"}},(function(e){!0!==e&&localStorage.setItem("isStart","false")})),0==chrome.runtime.onMessage.hasListener(this.onMessage.bind(this))&&chrome.runtime.onMessage.addListener(this.onMessage.bind(this)),this.sendMessageToPopup({type:"hello"})}return e.prototype.onMessage=function(e,t,n){switch(e.method){case"getUrl":this.sendMessage({action:"goToUrl",value:location.href,path:null}),n(location.href);break;case"startBrowserActionMonitor":localStorage.setItem("isStart","true"),this.startBrowserActionMonitor();break;case"startXHRMonitor":this.startXHRMonitor();break;default:throw new Error("Message method not support - add new case "+e.method)}n({successful:!0})},e.prototype.sendMessage=function(e){if(chrome.runtime){if(this.actionLog.length>0){var t=this.actionLog[this.actionLog.length-1];if(t.path===e.path&&"sendKeys"===t.action&&null!==e.value&&-1===e.value.indexOf("Keys."))return void this.sendUpdateMessage(e)}this.actionLog.push(e),this.sendMessageToPopup({type:"insert",data:e})}},e.prototype.sendUpdateMessage=function(e){this.sendMessageToPopup({type:"appendLastValue",data:e})},e.prototype.sendMessageToPopup=function(e,t){chrome.runtime&&chrome.runtime.sendMessage(e,(function(e){console.log(e),t&&t(e)}))},e.prototype.startXHRMonitor=function(){!0!==this.isInit.startXHRMonitor&&(this.isInit.startXHRMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),(new i).startMonitor(this.sendMessage.bind(this)))},e.prototype.startBrowserActionMonitor=function(){!0!==this.isInit.startBrowserActionMonitor&&(this.isInit.startBrowserActionMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),this.xpathHelper=new a,new o(this.xpathHelper,this.sendMessage.bind(this)))},e}())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jyb3dzZXJBY3Rpb25Nb25pdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy94cGF0aEhlbHBlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvcmVxdWVzdE1vbml0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwieHBhdGhIZWxwZXIiLCJzZW5kTWVzc2FnZSIsImFkZEtleURvd25FdmVudExpc3RlbmVyIiwiZSIsImFjdGl2ZUVsZW1lbnQiLCJkb2N1bWVudCIsInhwYXRoIiwiZ2V0SW5wdXRFbGVtZW50WFBhdGgiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJhY3Rpb24iLCJwYXRoIiwic2V0VGltZW91dCIsInF1ZXJ5U2VsZWN0b3IiLCJzdWJtaXQiLCJhZGRLZXlVcEV2ZW50TGlzdGVuZXIiLCJjb2RlIiwidG9Mb3dlckNhc2UiLCJIVE1MSW5wdXRFbGVtZW50IiwiZ2V0QWN0aW9uRWxlbWVudFhQYXRoIiwiZ2V0RWxlbWVudFhQYXRoIiwiZGF0YSIsInRvVXBwZXJDYXNlIiwiYWRkQ2xpY2tFdmVudExpc3RlbmVyIiwiY2hlY2tBbmRNb25pdG9yU2VsZWN0RWxlbWVudCIsInRhcmdldCIsImFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lciIsImNvbnNvbGUiLCJsb2ciLCJhZGRNb3VzZUxpc3RlbmVyIiwid2hpY2giLCJyaWdodENsaWNrRWxlbWVudENsaWNrZWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJvbkNoYW5nZVNlbGVjdCIsImV2ZW50IiwidGhpcyIsIm9uZGJsY2xpY2siLCJvbmtleXVwIiwib25rZXlkb3duIiwib25tb3VzZWRvd24iLCJlbGVtZW50Iiwibm9kZU5hbWUiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0WFBhdGgiLCJub2RlIiwiaGFzQXR0cmlidXRlIiwidGFnTmFtZSIsImlkIiwiZ2V0QXR0cmlidXRlIiwib2xkIiwicGFyZW50Tm9kZSIsImRvYyIsInVuZGVmaW5lZCIsInBvcyIsInRlbXBpdGVtMiIsImRvY3VtZW50RWxlbWVudCIsIm5vZGVUeXBlIiwicHJldmlvdXNTaWJsaW5nIiwicmVwbGFjZSIsImdldEVsZW1lbnRYUGF0aEJ5VHlwZSIsInR5cGUiLCJjbG9uZU5vZGUiLCJpc0ZpcnN0IiwiZ2V0RWxlbWVudEJ5WFBhdGgiLCJ4UGF0aCIsImV2YWx1YXRlIiwic2luZ2xlTm9kZVZhbHVlIiwiY2hhckF0Iiwic3Vic3RyIiwicHJldkVsZW0iLCJhcnIiLCJzcGxpdCIsImxlbmd0aCIsInN0ZXAiLCJmaWx0ZXIiLCJ2IiwibWF0Y2giLCJlbGVtIiwiZWxlbU51bSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5WFBhdGhDb3VudCIsIlhQYXRoUmVzdWx0IiwiQU5ZX1RZUEUiLCJzdGFydE1vbml0b3IiLCJjaHJvbWUiLCJleHRlbnNpb24iLCJjb25uZWN0Iiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJtc2ciLCJ1cmwiLCJtZXRob2QiLCJ4aHJPYmplY3QiLCJzdGF0dXNDb2RlIiwiYWN0aW9uTG9nIiwiaXNJbml0Iiwic3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvciIsInN0YXJ0WEhSTW9uaXRvciIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZW5kTWVzc2FnZVRvUG9wdXAiLCJyZXNwb25zZSIsInNldEl0ZW0iLCJydW50aW1lIiwiaGFzTGlzdGVuZXIiLCJtZXNzYWdlIiwic2VuZGVyIiwic2VuZFJlc3BvbnNlIiwibG9jYXRpb24iLCJocmVmIiwiRXJyb3IiLCJzdWNjZXNzZnVsIiwicHJldiIsImluZGV4T2YiLCJzZW5kVXBkYXRlTWVzc2FnZSIsInB1c2giLCJjYWxsQmFjayIsIkpTT04iLCJzdHJpbmdpZnkiLCJSZXF1ZXN0aW9uTW9uaXRvciIsIlhwYXRoSGVscGVyIiwiQnJvd3NlckFjdGlvbk1vbml0b3IiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMsR0FDM0NaLEVBQW9CYSxFQUFFWCxFQUFTUyxJQUNsQ0csT0FBT0MsZUFBZWIsRUFBU1MsRUFBTSxDQUFFSyxZQUFZLEVBQU1DLElBQUtMLEtBS2hFWixFQUFvQmtCLEVBQUksU0FBU2hCLEdBQ1gsb0JBQVhpQixRQUEwQkEsT0FBT0MsYUFDMUNOLE9BQU9DLGVBQWViLEVBQVNpQixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FFN0RQLE9BQU9DLGVBQWViLEVBQVMsYUFBYyxDQUFFbUIsT0FBTyxLQVF2RHJCLEVBQW9Cc0IsRUFBSSxTQUFTRCxFQUFPRSxHQUV2QyxHQURVLEVBQVBBLElBQVVGLEVBQVFyQixFQUFvQnFCLElBQy9CLEVBQVBFLEVBQVUsT0FBT0YsRUFDcEIsR0FBVyxFQUFQRSxHQUE4QixpQkFBVkYsR0FBc0JBLEdBQVNBLEVBQU1HLFdBQVksT0FBT0gsRUFDaEYsSUFBSUksRUFBS1gsT0FBT1ksT0FBTyxNQUd2QixHQUZBMUIsRUFBb0JrQixFQUFFTyxHQUN0QlgsT0FBT0MsZUFBZVUsRUFBSSxVQUFXLENBQUVULFlBQVksRUFBTUssTUFBT0EsSUFDdEQsRUFBUEUsR0FBNEIsaUJBQVRGLEVBQW1CLElBQUksSUFBSU0sS0FBT04sRUFBT3JCLEVBQW9CVSxFQUFFZSxFQUFJRSxFQUFLLFNBQVNBLEdBQU8sT0FBT04sRUFBTU0sSUFBUUMsS0FBSyxLQUFNRCxJQUM5SSxPQUFPRixHQUlSekIsRUFBb0I2QixFQUFJLFNBQVMxQixHQUNoQyxJQUFJUyxFQUFTVCxHQUFVQSxFQUFPcUIsV0FDN0IsV0FBd0IsT0FBT3JCLEVBQWdCLFNBQy9DLFdBQThCLE9BQU9BLEdBRXRDLE9BREFILEVBQW9CVSxFQUFFRSxFQUFRLElBQUtBLEdBQzVCQSxHQUlSWixFQUFvQmEsRUFBSSxTQUFTaUIsRUFBUUMsR0FBWSxPQUFPakIsT0FBT2tCLFVBQVVDLGVBQWUxQixLQUFLdUIsRUFBUUMsSUFHekcvQixFQUFvQmtDLEVBQUksR0FJakJsQyxFQUFvQkEsRUFBb0JtQyxFQUFJLEcsc0NDL0VyRCxpQkFJSSxXQUFZQyxFQUEwQkMsR0FBdEMsV0FhQSxLQUFBQyx3QkFBMEIsU0FBQ0MsR0FDdkIsSUFBTUMsRUFBZ0JDLFNBQVNELGNBQzNCRSxFQUFRLEVBQUtOLFlBQVlPLHFCQUFxQkgsR0FFakMsSUFBYkQsRUFBRUssVUFDRkwsRUFBRU0saUJBQ0YsRUFBS1IsWUFBWSxDQUNiUyxPQUFRLFdBQVlDLEtBQU1MLEVBQU9yQixNQUFPLGVBRTVDMkIsWUFBVyxXQUVQUCxTQUFTUSxjQUFjLFFBQVFDLFdBQ2hDLE9BR1gsS0FBQUMsc0JBQXdCLFNBQUNaLEdBQ3JCLElBQU1DLEVBQWdCQyxTQUFTRCxjQUMzQkUsRUFBUSxFQUFLTixZQUFZTyxxQkFBcUJILEdBQ2xELEdBQTRCLE9BQXhCRCxFQUFFYSxLQUFLQyxlQUFrRCxhQUF4QmQsRUFBRWEsS0FBS0MsZUFBd0QsY0FBeEJkLEVBQUVhLEtBQUtDLGVBQXlELGFBQXhCZCxFQUFFYSxLQUFLQyxlQUM1RixnQkFBeEJkLEVBQUVhLEtBQUtDLGVBQTJELGVBQXhCZCxFQUFFYSxLQUFLQyxlQUEwRCxZQUF4QmQsRUFBRWEsS0FBS0MsZUFBdUQsV0FBeEJkLEVBQUVhLEtBQUtDLGVBS2hJLEdBQWlCLElBQWJkLEVBQUVLLFFBR04sR0FBZSxjQUFYTCxFQUFFYSxLQUVULEVBQUtmLFlBQVksQ0FDYlMsT0FBUSxXQUFZQyxLQUFNTCxFQUFPckIsTUFBTyx3QkFJM0MsR0FBSW1CLGFBQXlCYyxpQkFBa0IsQ0FHbEMsV0FEVlosRUFBUSxFQUFLTixZQUFZbUIsc0JBQXNCZixNQUUvQ0UsRUFBUSxFQUFLTixZQUFZb0IsZ0JBQWdCaEIsSUFFN0MsSUFBSWlCLEVBQU8sQ0FBRVgsT0FBUSxXQUFZQyxLQUFNTCxFQUFPckIsTUFBT2tCLEVBQUVaLEtBQ3ZELEVBQUtVLFlBQVlvQixTQXJCakIsRUFBS3BCLFlBQVksQ0FDYlMsT0FBUSxXQUFZQyxLQUFNTCxFQUFPckIsTUFBTyxRQUFVa0IsRUFBRWEsS0FBS00saUJBdUJyRSxLQUFBQyxzQkFBd0IsU0FBQ3BCLEdBQ3JCLEVBQUtxQiw2QkFBNkJyQixFQUFFc0IsUUFDcEMsSUFBSW5CLEVBQVEsRUFBS04sWUFBWW1CLHNCQUFzQmhCLEVBQUVzQixRQUlyRCxHQUhjLFVBQVZuQixJQUNBQSxFQUFRLEVBQUtOLFlBQVlvQixnQkFBZ0JqQixFQUFFc0IsU0FFakMsT0FBVm5CLEVBQUosQ0FHQSxJQUFJZSxFQUFzQixDQUFFWCxPQUFRLFFBQVNDLEtBQU1MLEVBQU9yQixNQUFPLE1BS2pFLEVBQUtnQixZQUFZb0IsS0FFckIsS0FBQUssNEJBQThCLFNBQUN2QixHQUMzQndCLFFBQVFDLElBQUksbUJBQ1pELFFBQVFDLElBQUl6QixJQUVoQixLQUFBMEIsaUJBQW1CLFNBQUMxQixHQUNBLElBQVpBLEVBQUUyQixPQUNGLEVBQUtQLHNCQUFzQnBCLEdBRS9CLEVBQUs0Qix5QkFBMkI1QixFQUFFc0IsT0FDbEMsRUFBS00seUJBQXlCQyxVQUFVQyxJQUFJLHdCQVVoRCxLQUFBQyxlQUFpQixTQUFDQyxHQUNkLElBQU03QixFQUFRLEVBQUtOLFlBQVlvQixnQkFBZ0JlLEVBQU1WLE9BQVFwQixVQUM3RCxFQUFLSixZQUFZLENBQUVoQixNQUFPa0QsRUFBTVYsT0FBT3hDLE1BQU95QixPQUFRLGdCQUFpQkMsS0FBTUwsS0E3RjdFOEIsS0FBS3BDLFlBQWNBLEVBQ25Cb0MsS0FBS25DLFlBQWNBLEVBQ1EsTUFBdkJJLFNBQVNnQyxhQUdiaEMsU0FBU2lDLFFBQVVGLEtBQUtyQixzQkFDeEJWLFNBQVNrQyxVQUFZSCxLQUFLbEMsd0JBQzFCRyxTQUFTZ0MsV0FBYUQsS0FBS1YsNEJBQzNCckIsU0FBU21DLFlBQWNKLEtBQUtQLGtCQXdGcEMsT0FaSSxZQUFBTCw2QkFBQSxTQUE2QmlCLEdBQ0EsV0FBckJBLEVBQVFDLFVBSVpELEVBQVFFLGlCQUFpQixTQUFVUCxLQUFLRixpQkFPaEQsRUFyR0EsR0NIQSwyQkE0SUEsT0ExSUksWUFBQVUsU0FBQSxTQUFTQyxHQUNMLEdBQUlBLEVBQUtDLGFBQWEsTUFDbEIsTUFBTyxLQUFPRCxFQUFLRSxRQUFVLFNBQVdGLEVBQUtHLEdBQUssS0FHdEQsR0FBSUgsRUFBS0MsYUFBYSxTQUNsQixNQUFPLEtBQU9ELEVBQUtFLFFBQVUsWUFBY0YsRUFBS0ksYUFBYSxTQUFXLEtBRzVFLElBQUlDLEVBQU0sSUFBTUwsRUFBS0UsUUFHckIsT0FGZVgsS0FBS1EsU0FBU0MsRUFBS00sWUFBY0QsR0FJcEQsWUFBQTlCLGdCQUFBLFNBQWdCeUIsRUFBbUJPLFFBQUEsSUFBQUEsV0FBQSxHQUNwQkMsTUFBUEQsSUFBa0JBLEVBQU0vQyxVQUc1QixJQUZBLElBQ0lpRCxFQUFLQyxFQURMakQsRUFBUSxHQUVMdUMsSUFBU08sRUFBSUksaUJBQWlCLENBRWpDLElBREFGLEVBQU0sRUFBR0MsRUFBWVYsRUFDZFUsR0FDd0IsSUFBdkJBLEVBQVVFLFVBQWtCRixFQUFVYixXQUFhRyxFQUFNSCxXQUFZWSxHQUFPLEdBQ2hGQyxFQUFZQSxFQUFVRyxnQkFFMUJwRCxFQUFRdUMsRUFBTUgsU0FBVyxJQUFNWSxFQUFNLEtBQVloRCxFQUNqRHVDLEVBQU9BLEVBQU1NLFdBSWpCLE9BREE3QyxHQURBQSxFQUFRLElBQU04QyxFQUFJSSxnQkFBZ0JkLFNBQVcsSUFBTXBDLEdBQ3JDcUQsUUFBUSxNQUFPLEtBR2pDLFlBQUFDLHNCQUFBLFNBQXNCZixFQUFtQk8sRUFBMkJTLFFBQTNCLElBQUFULFdBQUEsUUFBMkIsSUFBQVMsTUFBQSxTQUNoRGhCLEVBQUtpQixXQUFVLEdBQ3BCVCxNQUFQRCxJQUFrQkEsRUFBTS9DLFVBSTVCLElBSEEsSUFFSWlELEVBQUtDLEVBRkxqRCxFQUFRLEdBQ1J5RCxHQUFVLEVBRVBsQixJQUFTTyxFQUFJSSxpQkFBaUIsQ0FFakMsSUFEQUYsRUFBTSxFQUFHQyxFQUFZVixFQUNkVSxHQUN3QixJQUF2QkEsRUFBVUUsVUFBa0JGLEVBQVViLFdBQWFHLEVBQUtILFdBQVlZLEdBQU8sR0FDL0VDLEVBQVlBLEVBQVVHLGdCQWUxQixJQWJnQixJQUFaSyxHQUFvQmxCLEdBQVNBLEVBQUtILFVBQVltQixHQUU5Q3ZELEVBQVF1QyxFQUFLSCxTQUFXLElBQU1ZLEVBQU0sS0FBWWhELEVBT2hEeUQsR0FBVSxJQUNTLElBQVpBLElBQ1B6RCxFQUFRdUMsRUFBS0gsU0FBVyxJQUFNWSxFQUFNLEtBQVloRCxJQUUvQ3VDLEVBQ0QsTUFFSkEsRUFBT0EsRUFBS00sV0FZaEIsT0FUQTdDLEdBREFBLEVBQVEsSUFBTThDLEVBQUlJLGdCQUFnQmQsU0FBVyxJQUFNcEMsR0FDckNxRCxRQUFRLE1BQU8sS0FXakMsWUFBQXBELHFCQUFBLFNBQXFCc0MsRUFBbUJPLEdBQ3BDLFlBRG9DLElBQUFBLFdBQUEsR0FDN0JoQixLQUFLd0Isc0JBQXNCZixFQUFLTyxFQUFJLFVBRS9DLFlBQUFqQyxzQkFBQSxTQUFzQjBCLEVBQW1CTyxRQUFBLElBQUFBLFdBQUEsR0FFckJQLEVBQUtpQixXQUFVLEdBQ3BCVCxNQUFQRCxJQUFrQkEsRUFBTS9DLFVBSTVCLElBSEEsSUFFSWlELEVBQUtDLEVBRkxqRCxFQUFRLEdBQ1J5RCxHQUFVLEVBRVBsQixJQUFTTyxFQUFJSSxpQkFBaUIsQ0FFakMsSUFEQUYsRUFBTSxFQUFHQyxFQUFZVixFQUNkVSxHQUN3QixJQUF2QkEsRUFBVUUsVUFBa0JGLEVBQVViLFdBQWFHLEVBQUtILFdBQVlZLEdBQU8sR0FDL0VDLEVBQVlBLEVBQVVHLGdCQWUxQixJQWJnQixJQUFaSyxJQUFvQmxCLEdBQTBCLEtBQWpCQSxFQUFLSCxVQUFvQyxVQUFqQkcsRUFBS0gsVUFBeUMsVUFBakJHLEVBQUtILFVBVXBFLElBQVpxQixJQUNQekQsRUFBUXVDLEVBQUtILFNBQVcsSUFBTVksRUFBTSxLQUFZaEQsSUFUaERBLEVBQVF1QyxFQUFLSCxTQUFXLElBQU1ZLEVBQU0sS0FBWWhELEVBT2hEeUQsR0FBVSxJQUlUbEIsRUFDRCxNQUVKQSxFQUFPQSxFQUFLTSxXQVloQixPQVRBN0MsR0FEQUEsRUFBUSxJQUFNOEMsRUFBSUksZ0JBQWdCZCxTQUFXLElBQU1wQyxHQUNyQ3FELFFBQVEsTUFBTyxLQVdqQyxZQUFBSyxrQkFBQSxTQUFrQkMsRUFBZWIsR0FFN0IsR0FES0EsSUFBS0EsRUFBTS9DLFVBQ1orQyxFQUFJYyxTQUFVLE9BQU9kLEVBQUljLFNBQVNELEVBQU81RCxTQUFVLEtBQU0sRUFBRyxNQUFNOEQsZ0JBRXRFLEtBQTBCLEtBQW5CRixFQUFNRyxPQUFPLElBQVdILEVBQVFBLEVBQU1JLE9BQU8sR0FHcEQsSUFGQSxJQUFJQyxFQUFXbEIsRUFDWG1CLEVBQU1OLEVBQU1PLE1BQU0sS0FDYnhHLEVBQUksRUFBR0EsRUFBSXVHLEVBQUlFLE9BQVF6RyxJQUFLLENBQ2pDLElBQUkwRyxFQUFZSCxFQUFJdkcsR0FBR3dHLE1BQU0sb0JBQW9CRyxRQUFPLFNBQUNDLEdBQVEsUUFBYyxJQUFMQSxHQUFXQSxFQUFFQyxNQUFNLFdBQVl6QyxNQUNyRzBDLEVBQU9KLEVBQUssR0FDWkssRUFBVUwsRUFBSyxHQUFLQSxFQUFLLEdBQUssRUFBSSxFQUN0QyxLQUFJMUcsRUFBSXVHLEVBQUlFLE9BQVMsR0FDaEIsT0FBT0gsRUFBU1UscUJBQXFCRixHQUFNQyxHQUR4QlQsRUFBV0EsRUFBU1UscUJBQXFCRixHQUFNQyxLQUkvRSxZQUFBRSx1QkFBQSxTQUF1QmhCLEVBQWViLEdBQzdCQSxJQUFLQSxFQUFNL0MsVUFDaEJBLFNBQVM2RCxTQUFTLFNBQVdELEVBQVEsSUFBS2IsRUFBSyxLQUFNOEIsWUFBWUMsU0FBVSxPQUVuRixFQTVJQSxHQ0NBLGFBQ0ksY0EyQkosT0F4QkksWUFBQUMsYUFBQSxTQUFhbkYsR0FFUW9GLE9BQVFDLFVBQVVDLFFBQVEsQ0FDdkNoSCxLQUFNLHlCQUdMaUgsVUFBVUMsYUFBWSxTQUFVQyxHQUNoQixhQUFiQSxFQUFJN0IsS0FDSjVELEVBQVksQ0FDUlMsT0FBUWdGLEVBQUk3QixLQUNaNUUsTUFBTyxDQUFDeUcsRUFBSXJFLEtBQUtzRSxJQUFLRCxFQUFJckUsS0FBS3VFLFFBQy9CQyxVQUFVSCxFQUNWL0UsS0FBTSxPQUVVLFlBQWIrRSxFQUFJN0IsTUFDWDVELEVBQVksQ0FDUlMsT0FBUWdGLEVBQUk3QixLQUNaNUUsTUFBTyxDQUFDeUcsRUFBSXJFLEtBQUtzRSxJQUFLRCxFQUFJckUsS0FBS3VFLE9BQVFGLEVBQUlyRSxLQUFLeUUsWUFDaERELFVBQVVILEVBQ1YvRSxLQUFNLFdBSzFCLEVBNUJBLEdDQUEsSUNJQSxXQVNJLGFBSkEsS0FBQW9GLFVBQTZCLEdBRTdCLEtBQUFDLE9BQXlELENBQUVDLDJCQUEyQixFQUFPQyxpQkFBaUIsR0FHbEUsU0FBcENDLGFBQWFDLFFBQVEsWUFDckJoRSxLQUFLaUUsbUJBQW1CLENBQ3BCeEMsS0FBTSxVQUFXeEMsS0FBTSxDQUNuQlgsT0FBUSxlQUViLFNBQUM0RixJQUNpQixJQUFiQSxHQUNBSCxhQUFhSSxRQUFRLFVBQVcsWUFJMkIsR0FBbkVsQixPQUFPbUIsUUFBUWhCLFVBQVVpQixZQUFZckUsS0FBS29ELFVBQVVoRyxLQUFLNEMsUUFDekRpRCxPQUFPbUIsUUFBUWhCLFVBQVVDLFlBQVlyRCxLQUFLb0QsVUFBVWhHLEtBQUs0QyxPQUc3REEsS0FBS2lFLG1CQUFtQixDQUFFeEMsS0FBTSxVQTRFeEMsT0ExRUksWUFBQTJCLFVBQUEsU0FBVWtCLEVBQWNDLEVBQWFDLEdBQ2pDLE9BQVFGLEVBQVFkLFFBQ1osSUFBSyxTQUNEeEQsS0FBS25DLFlBQVksQ0FDYlMsT0FBUSxVQUNSekIsTUFBTzRILFNBQVNDLEtBQ2hCbkcsS0FBTSxPQUVWaUcsRUFBYUMsU0FBU0MsTUFDdEIsTUFDSixJQUFLLDRCQUNEWCxhQUFhSSxRQUFRLFVBQVcsUUFDaENuRSxLQUFLNkQsNEJBQ0wsTUFDSixJQUFLLGtCQUNEN0QsS0FBSzhELGtCQUNMLE1BQ0osUUFDSSxNQUFNLElBQUlhLE1BQU0sNkNBQStDTCxFQUFRZCxRQUcvRWdCLEVBQWEsQ0FBRUksWUFBWSxLQUUvQixZQUFBL0csWUFBQSxTQUFZb0IsR0FDUixHQUFLZ0UsT0FBT21CLFFBQVosQ0FHQSxHQUFJcEUsS0FBSzJELFVBQVV0QixPQUFTLEVBQUcsQ0FDM0IsSUFBTXdDLEVBQU83RSxLQUFLMkQsVUFBVTNELEtBQUsyRCxVQUFVdEIsT0FBUyxHQUNwRCxHQUFJd0MsRUFBS3RHLE9BQVNVLEVBQUtWLE1BQXdCLGFBQWhCc0csRUFBS3ZHLFFBQXlDLE9BQWZXLEVBQUtwQyxRQUFtRCxJQUFqQ29DLEVBQUtwQyxNQUFNaUksUUFBUSxTQUVwRyxZQURBOUUsS0FBSytFLGtCQUFrQjlGLEdBSS9CZSxLQUFLMkQsVUFBVXFCLEtBQUsvRixHQUNwQmUsS0FBS2lFLG1CQUFtQixDQUFFeEMsS0FBTSxTQUFVeEMsS0FBTUEsTUFHcEQsWUFBQThGLGtCQUFBLFNBQWtCOUYsR0FDZGUsS0FBS2lFLG1CQUFtQixDQUFFeEMsS0FBTSxrQkFBbUJ4QyxLQUFNQSxLQUc3RCxZQUFBZ0YsbUJBQUEsU0FBbUJLLEVBQVNXLEdBQ3BCaEMsT0FBT21CLFNBQ1BuQixPQUFPbUIsUUFBUXZHLFlBQVl5RyxHQUFTLFNBQVVKLEdBQzFDM0UsUUFBUUMsSUFBSTBFLEdBQ05lLEdBQ0ZBLEVBQVNmLE9BT2pCLFlBQUFKLGdCQUFSLFlBQ3dDLElBQWhDOUQsS0FBSzRELE9BQU9FLGtCQUdoQjlELEtBQUs0RCxPQUFPRSxpQkFBa0IsRUFDOUJDLGFBQWFJLFFBQVEsU0FBVWUsS0FBS0MsVUFBVW5GLEtBQUs0RCxVQUNuRCxJQUFJd0IsR0FBb0JwQyxhQUFhaEQsS0FBS25DLFlBQVlULEtBQUs0QyxTQUV2RCxZQUFBNkQsMEJBQVIsWUFDa0QsSUFBMUM3RCxLQUFLNEQsT0FBT0MsNEJBR2hCN0QsS0FBSzRELE9BQU9DLDJCQUE0QixFQUN4Q0UsYUFBYUksUUFBUSxTQUFVZSxLQUFLQyxVQUFVbkYsS0FBSzRELFNBQ25ENUQsS0FBS3BDLFlBQWMsSUFBSXlILEVBR3ZCLElBQUlDLEVBQXFCdEYsS0FBS3BDLFlBQWFvQyxLQUFLbkMsWUFBWVQsS0FBSzRDLFNBR3pFLEVBckdBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7IE9wZXJhdG9yTW9kZWwgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL3NyYy9saWIvbW9kZWxzL29wZXJhdG9yTW9kZWxcIjtcclxuaW1wb3J0IHsgWHBhdGhIZWxwZXIgfSBmcm9tIFwiLi94cGF0aEhlbHBlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJyb3dzZXJBY3Rpb25Nb25pdG9yIHtcclxuICAgIHhwYXRoSGVscGVyOiBYcGF0aEhlbHBlcjtcclxuICAgIHJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZDogYW55O1xyXG4gICAgc2VuZE1lc3NhZ2U6IEZ1bmN0aW9uO1xyXG4gICAgY29uc3RydWN0b3IoeHBhdGhIZWxwZXI6IFhwYXRoSGVscGVyLCBzZW5kTWVzc2FnZTogRnVuY3Rpb24pIHtcclxuICAgICAgICB0aGlzLnhwYXRoSGVscGVyID0geHBhdGhIZWxwZXI7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSA9IHNlbmRNZXNzYWdlO1xyXG4gICAgICAgIGlmIChkb2N1bWVudC5vbmRibGNsaWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkb2N1bWVudC5vbmtleXVwID0gdGhpcy5hZGRLZXlVcEV2ZW50TGlzdGVuZXI7XHJcbiAgICAgICAgZG9jdW1lbnQub25rZXlkb3duID0gdGhpcy5hZGRLZXlEb3duRXZlbnRMaXN0ZW5lcjtcclxuICAgICAgICBkb2N1bWVudC5vbmRibGNsaWNrID0gdGhpcy5hZGREb3VibGVDbGlja0V2ZW50TGlzdGVuZXI7XHJcbiAgICAgICAgZG9jdW1lbnQub25tb3VzZWRvd24gPSB0aGlzLmFkZE1vdXNlTGlzdGVuZXI7XHJcbiAgICAgIFxyXG5cclxuICAgIH1cclxuICAgIGFkZEtleURvd25FdmVudExpc3RlbmVyID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0SW5wdXRFbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHsvL0VOVEVSIFxyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2VuZEtleXMnLCBwYXRoOiB4cGF0aCwgdmFsdWU6ICdLZXlzLkVOVEVSJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETyBjaGVjayBpZiBvYmplY3QgJ2UnIGNhbiBiZSByZXN1Ym1pdGVkLiAtIGlzc3VlIGNhbiBiZSB3aGVuIHlvdSBoYXZlIG1vcmUgdGhhbiAxIGZvcm1cclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm0nKS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgYWRkS2V5VXBFdmVudExpc3RlbmVyID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0SW5wdXRFbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgaWYgKGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwidGFiXCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJzaGlmdGxlZnRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcInNoaWZ0cmlnaHRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSAnYmFja3NwYWNlJ1xyXG4gICAgICAgICAgICB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcImNvbnRyb2xyaWdodFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiY29udHJvbGxlZnRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcImFsdHJpZ2h0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJhbHRsZWZ0XCIpIHtcclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZW5kS2V5cycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogJ0tleXMuJyArIGUuY29kZS50b1VwcGVyQ2FzZSgpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcclxuICAgICAgICAgICAgLy9FTlRFUiBpcyBoYW5kbGVyIGluIGFkZEtleURvd25FdmVudExpc3RlbmVyXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGUuY29kZSA9PT0gXCJCYWNrc3BhY2VcIikge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZW5kS2V5cycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogJ0tleXMuQkFDS1NQQUNFJ1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYWN0aXZlRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0QWN0aW9uRWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBpZiAoeHBhdGggPT09ICcvSFRNTCcpIHtcclxuICAgICAgICAgICAgICAgIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB7IGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiBlLmtleSB9O1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFkZENsaWNrRXZlbnRMaXN0ZW5lciA9IChlOiBFdmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2hlY2tBbmRNb25pdG9yU2VsZWN0RWxlbWVudChlLnRhcmdldCk7XHJcbiAgICAgICAgdmFyIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRBY3Rpb25FbGVtZW50WFBhdGgoZS50YXJnZXQgYXMgTm9kZSk7XHJcbiAgICAgICAgaWYgKHhwYXRoID09PSAnL0hUTUwnKSB7XHJcbiAgICAgICAgICAgIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoZS50YXJnZXQgYXMgTm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh4cGF0aCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBkYXRhOiBPcGVyYXRvck1vZGVsID0geyBhY3Rpb246ICdjbGljaycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogbnVsbCB9XHJcbiAgICAgICAgLy92YXIgZGF0YSA9IHsgYWN0aW9uOiAnY2xpY2snLCBwYXRoOiB4cGF0aCwgdmFsdWU6IG51bGwgfVxyXG4gICAgICAgIC8vdGhpcy50ZW1wRXZlbnRFbGVtZW50ID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50QnlYUGF0aCh4cGF0aCwgZG9jdW1lbnQpO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShkYXRhKTtcclxuICAgIH1cclxuICAgIGFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJkb3VibGUgY2xpY2shISFcIik7XHJcbiAgICAgICAgY29uc29sZS5sb2coZSlcclxuICAgIH1cclxuICAgIGFkZE1vdXNlTGlzdGVuZXIgPSAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgIGlmIChlLndoaWNoICE9PSAzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ2xpY2tFdmVudExpc3RlbmVyKGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgIHRoaXMucmlnaHRDbGlja0VsZW1lbnRDbGlja2VkLmNsYXNzTGlzdC5hZGQoXCJ0Yy1zZWxlY3RlZC1lbGVtZW50XCIpO1xyXG4gICAgICAgIC8vcmlnaHQgY2xpY2sgXHJcbiAgICB9XHJcbiAgICBjaGVja0FuZE1vbml0b3JTZWxlY3RFbGVtZW50KGVsZW1lbnQ6IGFueSkge1xyXG4gICAgICAgIGlmIChlbGVtZW50Lm5vZGVOYW1lICE9PSBcIlNFTEVDVFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vbkNoYW5nZVNlbGVjdCk7XHJcbiAgICB9XHJcbiAgICBvbkNoYW5nZVNlbGVjdCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoZXZlbnQudGFyZ2V0LCBkb2N1bWVudCk7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7IHZhbHVlOiBldmVudC50YXJnZXQudmFsdWUsIGFjdGlvbjogJ3NlbGVjdEJ5VmFsdWUnLCBwYXRoOiB4cGF0aCB9KTtcclxuXHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgWHBhdGhIZWxwZXIge1xyXG4gICAgXHJcbiAgICBnZXRYUGF0aChub2RlOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnLy8nICsgbm9kZS50YWdOYW1lICsgJ1tAaWQ9XCInICsgbm9kZS5pZCArICdcIl0nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlKFwiY2xhc3NcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcvLycgKyBub2RlLnRhZ05hbWUgKyAnW0BjbGFzcz1cIicgKyBub2RlLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpICsgJ1wiXSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgb2xkID0gJy8nICsgbm9kZS50YWdOYW1lO1xyXG4gICAgICAgIGxldCBuZXdfcGF0aCA9IHRoaXMuZ2V0WFBhdGgobm9kZS5wYXJlbnROb2RlKSArIG9sZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld19wYXRoO1xyXG4gICAgfVxyXG4gICAgZ2V0RWxlbWVudFhQYXRoKG5vZGU6IE5vZGUgfCBudWxsLCBkb2M6IERvY3VtZW50ID0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKGRvYyA9PSB1bmRlZmluZWQpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9ICcnO1xyXG4gICAgICAgIHZhciBwb3MsIHRlbXBpdGVtMjtcclxuICAgICAgICB3aGlsZSAobm9kZSAhPT0gZG9jLmRvY3VtZW50RWxlbWVudCkge1xyXG4gICAgICAgICAgICBwb3MgPSAwOyB0ZW1waXRlbTIgPSBub2RlO1xyXG4gICAgICAgICAgICB3aGlsZSAodGVtcGl0ZW0yKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcGl0ZW0yLm5vZGVUeXBlID09PSAxICYmIHRlbXBpdGVtMi5ub2RlTmFtZSA9PT0gbm9kZSEubm9kZU5hbWUpIHsgcG9zICs9IDE7IH1cclxuICAgICAgICAgICAgICAgIHRlbXBpdGVtMiA9IHRlbXBpdGVtMi5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeHBhdGggPSBub2RlIS5ub2RlTmFtZSArICdbJyArIHBvcyArICddJyArICcvJyArIHhwYXRoO1xyXG4gICAgICAgICAgICBub2RlID0gbm9kZSEucGFyZW50Tm9kZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgeHBhdGggPSAnLycgKyBkb2MuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICsgJy8nICsgeHBhdGg7XHJcbiAgICAgICAgeHBhdGggPSB4cGF0aC5yZXBsYWNlKC9cXC8kLywgJycpO1xyXG4gICAgICAgIHJldHVybiB4cGF0aDtcclxuICAgIH1cclxuICAgIGdldEVsZW1lbnRYUGF0aEJ5VHlwZShub2RlOiBOb2RlIHwgbnVsbCwgZG9jOiBEb2N1bWVudCA9IHVuZGVmaW5lZCwgdHlwZTogc3RyaW5nPSdJTlBVVCcpIHtcclxuICAgICAgICB2YXIgbm9kZUNsb25lID0gbm9kZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGRvYyA9PSB1bmRlZmluZWQpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9ICcnO1xyXG4gICAgICAgIHZhciBpc0ZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICB2YXIgcG9zLCB0ZW1waXRlbTI7XHJcbiAgICAgICAgd2hpbGUgKG5vZGUgIT09IGRvYy5kb2N1bWVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcG9zID0gMDsgdGVtcGl0ZW0yID0gbm9kZTtcclxuICAgICAgICAgICAgd2hpbGUgKHRlbXBpdGVtMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBpdGVtMi5ub2RlVHlwZSA9PT0gMSAmJiB0ZW1waXRlbTIubm9kZU5hbWUgPT09IG5vZGUubm9kZU5hbWUpIHsgcG9zICs9IDE7IH1cclxuICAgICAgICAgICAgICAgIHRlbXBpdGVtMiA9IHRlbXBpdGVtMi5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzRmlyc3QgPT09IHRydWUgJiYgbm9kZSAmJiAobm9kZS5ub2RlTmFtZSA9PSB0eXBlKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHhwYXRoID0gbm9kZS5ub2RlTmFtZSArICdbJyArIHBvcyArICddJyArICcvJyArIHhwYXRoO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgKG5vZGUubm9kZU5hbWUgPT0gJ1NFTEVDVCcgJiYgb3BlblNlbGVjdE9wZW4gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBvcGVuU2VsZWN0T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgLy9yZXR1cm4gbnVsbDsgLT4gcmV0dXJuIG51bGwgaXMgYmFkIGlkZWEgYmVjYXVzZSBpdCB3aWxsIFxyXG4gICAgICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSB0cnVlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzRmlyc3QgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhwYXRoID0gJy8nICsgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSArICcvJyArIHhwYXRoO1xyXG4gICAgICAgIHhwYXRoID0geHBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuICAgICAgICAvLyBpZih4cGF0aD09PScvSFRNTCcpe1xyXG4gICAgICAgIC8vICAgICB2YXIgcmV0VmFsID1jb25maXJtKFwiRWxlbWVudCBpcyBub3QgYWN0aW9uIGVsZW1lbnQsIGRvIHlvdSB3YW50IHRvIGdldCBub3QgYWN0aXZlIGVsZW1lbnQ/XCIpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgaWYoIHJldFZhbCA9PSB0cnVlICkge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudFhQYXRoKG5vZGVDbG9uZSxkb2MpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgLy8gXHRcdFx0ICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgLy8gXHRcdCAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHhwYXRoO1xyXG4gICAgfVxyXG4gICAgZ2V0SW5wdXRFbGVtZW50WFBhdGgobm9kZTogTm9kZSB8IG51bGwsIGRvYzogRG9jdW1lbnQgPSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRFbGVtZW50WFBhdGhCeVR5cGUobm9kZSxkb2MsXCJJTlBVVFwiKTtcclxuICAgIH1cclxuICAgIGdldEFjdGlvbkVsZW1lbnRYUGF0aChub2RlOiBOb2RlIHwgbnVsbCwgZG9jOiBEb2N1bWVudCA9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICB2YXIgbm9kZUNsb25lID0gbm9kZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGRvYyA9PSB1bmRlZmluZWQpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9ICcnO1xyXG4gICAgICAgIHZhciBpc0ZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICB2YXIgcG9zLCB0ZW1waXRlbTI7XHJcbiAgICAgICAgd2hpbGUgKG5vZGUgIT09IGRvYy5kb2N1bWVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcG9zID0gMDsgdGVtcGl0ZW0yID0gbm9kZTtcclxuICAgICAgICAgICAgd2hpbGUgKHRlbXBpdGVtMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBpdGVtMi5ub2RlVHlwZSA9PT0gMSAmJiB0ZW1waXRlbTIubm9kZU5hbWUgPT09IG5vZGUubm9kZU5hbWUpIHsgcG9zICs9IDE7IH1cclxuICAgICAgICAgICAgICAgIHRlbXBpdGVtMiA9IHRlbXBpdGVtMi5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzRmlyc3QgPT09IHRydWUgJiYgbm9kZSAmJiAobm9kZS5ub2RlTmFtZSA9PSAnQScgfHwgbm9kZS5ub2RlTmFtZSA9PSAnQlVUVE9OJyB8fCBub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHhwYXRoID0gbm9kZS5ub2RlTmFtZSArICdbJyArIHBvcyArICddJyArICcvJyArIHhwYXRoO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgKG5vZGUubm9kZU5hbWUgPT0gJ1NFTEVDVCcgJiYgb3BlblNlbGVjdE9wZW4gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBvcGVuU2VsZWN0T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgLy9yZXR1cm4gbnVsbDsgLT4gcmV0dXJuIG51bGwgaXMgYmFkIGlkZWEgYmVjYXVzZSBpdCB3aWxsIFxyXG4gICAgICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSB0cnVlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzRmlyc3QgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhwYXRoID0gJy8nICsgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSArICcvJyArIHhwYXRoO1xyXG4gICAgICAgIHhwYXRoID0geHBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuICAgICAgICAvLyBpZih4cGF0aD09PScvSFRNTCcpe1xyXG4gICAgICAgIC8vICAgICB2YXIgcmV0VmFsID1jb25maXJtKFwiRWxlbWVudCBpcyBub3QgYWN0aW9uIGVsZW1lbnQsIGRvIHlvdSB3YW50IHRvIGdldCBub3QgYWN0aXZlIGVsZW1lbnQ/XCIpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgaWYoIHJldFZhbCA9PSB0cnVlICkge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudFhQYXRoKG5vZGVDbG9uZSxkb2MpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgLy8gXHRcdFx0ICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgLy8gXHRcdCAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHhwYXRoO1xyXG4gICAgfVxyXG4gICAgZ2V0RWxlbWVudEJ5WFBhdGgoeFBhdGg6IHN0cmluZywgZG9jOiBEb2N1bWVudCk6IGFueSB7XHJcbiAgICAgICAgaWYgKCFkb2MpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIGlmIChkb2MuZXZhbHVhdGUpIHJldHVybiBkb2MuZXZhbHVhdGUoeFBhdGgsIGRvY3VtZW50LCBudWxsLCA5LCBudWxsKS5zaW5nbGVOb2RlVmFsdWU7XHJcbiAgICAgICAgLy8gZm9yIElFXHJcbiAgICAgICAgd2hpbGUgKHhQYXRoLmNoYXJBdCgwKSA9PSAnLycpIHhQYXRoID0geFBhdGguc3Vic3RyKDEpO1xyXG4gICAgICAgIHZhciBwcmV2RWxlbSA9IGRvYztcclxuICAgICAgICB2YXIgYXJyID0geFBhdGguc3BsaXQoJy8nKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgc3RlcDogYW55ID0gYXJyW2ldLnNwbGl0KC8oXFx3KilcXFsoXFxkKilcXF0vZ2kpLmZpbHRlcigodikgPT4geyByZXR1cm4gISh2ID09ICcnIHx8IHYubWF0Y2goL1xccy9naSkpIH0sIHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgZWxlbSA9IHN0ZXBbMF07XHJcbiAgICAgICAgICAgIHZhciBlbGVtTnVtID0gc3RlcFsxXSA/IHN0ZXBbMV0gLSAxIDogMDsgLy8gLTEgc2luY2UgeHBhdGggaXMgMSBiYXNlZFxyXG4gICAgICAgICAgICBpZiAoaSA8IGFyci5sZW5ndGggLSAxKSBwcmV2RWxlbSA9IHByZXZFbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKGVsZW0pW2VsZW1OdW1dO1xyXG4gICAgICAgICAgICBlbHNlIHJldHVybiBwcmV2RWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZShlbGVtKVtlbGVtTnVtXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRFbGVtZW50QnlYUGF0aENvdW50KHhQYXRoOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQpIHtcclxuICAgICAgICBpZiAoIWRvYykgZG9jID0gZG9jdW1lbnQ7XHJcbiAgICAgICAgZG9jdW1lbnQuZXZhbHVhdGUoXCJjb3VudChcIiArIHhQYXRoICsgXCIpXCIsIGRvYywgbnVsbCwgWFBhdGhSZXN1bHQuQU5ZX1RZUEUsIG51bGwpO1xyXG4gICAgfVxyXG59IiwiXHJcbmV4cG9ydCBjbGFzcyBSZXF1ZXN0aW9uTW9uaXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgICB9XHJcbiAgICBzdGFydE1vbml0b3Ioc2VuZE1lc3NhZ2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHBvcnQgPSAoPGFueT5jaHJvbWUpLmV4dGVuc2lvbi5jb25uZWN0KHtcclxuICAgICAgICAgICAgbmFtZTogXCJTYW1wbGUgQ29tbXVuaWNhdGlvblwiXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHBvcnQub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICAgICAgaWYgKG1zZy50eXBlID09PSAneGhyU3RhcnQnKSB7XHJcbiAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBtc2cudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW21zZy5kYXRhLnVybCwgbXNnLmRhdGEubWV0aG9kXSxcclxuICAgICAgICAgICAgICAgICAgICB4aHJPYmplY3Q6bXNnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IG51bGxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1zZy50eXBlID09PSAneGhyRG9uZScpIHtcclxuICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IG1zZy50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbbXNnLmRhdGEudXJsLCBtc2cuZGF0YS5tZXRob2QsIG1zZy5kYXRhLnN0YXR1c0NvZGVdLFxyXG4gICAgICAgICAgICAgICAgICAgIHhock9iamVjdDptc2csXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCB7TWFpbn0gZnJvbSAnLi9tYWluJztcclxubmV3IE1haW4oKTtcclxuXHJcbiIsImltcG9ydCB7IE9wZXJhdG9yTW9kZWwgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL3NyYy9saWIvbW9kZWxzL29wZXJhdG9yTW9kZWxcIjtcclxuaW1wb3J0IHsgQnJvd3NlckFjdGlvbk1vbml0b3IgfSBmcm9tIFwiLi9icm93c2VyQWN0aW9uTW9uaXRvclwiO1xyXG5pbXBvcnQgeyBYcGF0aEhlbHBlciB9IGZyb20gXCIuL3hwYXRoSGVscGVyXCI7XHJcbmltcG9ydCB7IFJlcXVlc3Rpb25Nb25pdG9yIH0gZnJvbSBcIi4vcmVxdWVzdE1vbml0b3JcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBNYWluIHtcclxuICAgIHhwYXRoSGVscGVyOiBYcGF0aEhlbHBlcjtcclxuICAgIC8vIHRlbXBFdmVudEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgdGVtcEVsZW1lbnRWYWx1ZTogc3RyaW5nO1xyXG4gICAgcmlnaHRDbGlja0VsZW1lbnRDbGlja2VkOiBIVE1MRWxlbWVudDtcclxuICAgIGFjdGlvbkxvZzogT3BlcmF0b3JNb2RlbFtdID0gW107XHJcblxyXG4gICAgaXNJbml0OiB7IHN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IsIHN0YXJ0WEhSTW9uaXRvciB9ID0geyBzdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yOiBmYWxzZSwgc3RhcnRYSFJNb25pdG9yOiBmYWxzZSB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaXNTdGFydCcpID09PSAndHJ1ZScpIHtcclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2dldEluZm8nLCBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnaXNTdGFydGVkJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAhPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc1N0YXJ0JywgJ2ZhbHNlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmhhc0xpc3RlbmVyKHRoaXMub25NZXNzYWdlLmJpbmQodGhpcykpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcih0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BvcHVwKHsgdHlwZTogJ2hlbGxvJyB9KTtcclxuICAgIH1cclxuICAgIG9uTWVzc2FnZShtZXNzYWdlOiBhbnksIHNlbmRlcjogYW55LCBzZW5kUmVzcG9uc2U6IGFueSkge1xyXG4gICAgICAgIHN3aXRjaCAobWVzc2FnZS5tZXRob2QpIHtcclxuICAgICAgICAgICAgY2FzZSAnZ2V0VXJsJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dvVG9VcmwnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBsb2NhdGlvbi5ocmVmLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IG51bGxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKGxvY2F0aW9uLmhyZWYpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvcic6XHJcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaXNTdGFydCcsICd0cnVlJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdzdGFydFhIUk1vbml0b3InOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydFhIUk1vbml0b3IoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWVzc2FnZSBtZXRob2Qgbm90IHN1cHBvcnQgLSBhZGQgbmV3IGNhc2UgXCIgKyBtZXNzYWdlLm1ldGhvZCk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBzZW5kUmVzcG9uc2UoeyBzdWNjZXNzZnVsOiB0cnVlIH0pO1xyXG4gICAgfVxyXG4gICAgc2VuZE1lc3NhZ2UoZGF0YTogT3BlcmF0b3JNb2RlbCkge1xyXG4gICAgICAgIGlmICghY2hyb21lLnJ1bnRpbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hY3Rpb25Mb2cubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBwcmV2ID0gdGhpcy5hY3Rpb25Mb2dbdGhpcy5hY3Rpb25Mb2cubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgIGlmIChwcmV2LnBhdGggPT09IGRhdGEucGF0aCAmJiBwcmV2LmFjdGlvbiA9PT0gJ3NlbmRLZXlzJyAmJiAoZGF0YS52YWx1ZSAhPT0gbnVsbCAmJiBkYXRhLnZhbHVlLmluZGV4T2YoJ0tleXMuJykgPT09IC0xKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kVXBkYXRlTWVzc2FnZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFjdGlvbkxvZy5wdXNoKGRhdGEpO1xyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BvcHVwKHsgdHlwZTogJ2luc2VydCcsIGRhdGE6IGRhdGEgfSk7XHJcblxyXG4gICAgfVxyXG4gICAgc2VuZFVwZGF0ZU1lc3NhZ2UoZGF0YTogT3BlcmF0b3JNb2RlbCkge1xyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb1BvcHVwKHsgdHlwZTogJ2FwcGVuZExhc3RWYWx1ZScsIGRhdGE6IGRhdGEgfSk7XHJcblxyXG4gICAgfVxyXG4gICAgc2VuZE1lc3NhZ2VUb1BvcHVwKG1lc3NhZ2UsIGNhbGxCYWNrPykge1xyXG4gICAgICAgIGlmIChjaHJvbWUucnVudGltZSkge1xyXG4gICAgICAgICAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZShtZXNzYWdlLCBmdW5jdGlvbiAocmVzcG9uc2U6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEhY2FsbEJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsQmFjayhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBzdGFydFhIUk1vbml0b3IoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0LnN0YXJ0WEhSTW9uaXRvciA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNJbml0LnN0YXJ0WEhSTW9uaXRvciA9IHRydWU7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2lzSW5pdCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuaXNJbml0KSk7XHJcbiAgICAgICAgbmV3IFJlcXVlc3Rpb25Nb25pdG9yKCkuc3RhcnRNb25pdG9yKHRoaXMuc2VuZE1lc3NhZ2UuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0LnN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzSW5pdC5zdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yID0gdHJ1ZTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaXNJbml0JywgSlNPTi5zdHJpbmdpZnkodGhpcy5pc0luaXQpKTtcclxuICAgICAgICB0aGlzLnhwYXRoSGVscGVyID0gbmV3IFhwYXRoSGVscGVyKCk7XHJcblxyXG5cclxuICAgICAgICBuZXcgQnJvd3NlckFjdGlvbk1vbml0b3IodGhpcy54cGF0aEhlbHBlciwgdGhpcy5zZW5kTWVzc2FnZS5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbiJdLCJzb3VyY2VSb290IjoiIn0=