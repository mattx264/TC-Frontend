!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){function e(e,t){var n=this;this.addKeyDownEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);13==e.keyCode&&(e.preventDefault(),n.sendMessage({action:"sendKeys",path:o,value:"Keys.ENTER"}),setTimeout((function(){document.querySelector("form").submit()}),100))},this.addKeyUpEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);if("tab"!=e.code.toLowerCase()&&"shiftleft"!=e.code.toLowerCase()&&"shiftright"!=e.code.toLowerCase()&&"backspace"!=e.code.toLowerCase()&&"controlright"!=e.code.toLowerCase()&&"controlleft"!=e.code.toLowerCase()&&"altright"!=e.code.toLowerCase()&&"altleft"!=e.code.toLowerCase()){if(13!=e.keyCode)if("Backspace"===e.code)n.sendMessage({action:"sendKeys",path:o,value:"Keys.BACKSPACE"});else if(t instanceof HTMLInputElement){"/HTML"===(o=n.xpathHelper.getActionElementXPath(t))&&(o=n.xpathHelper.getElementXPath(t));var a={action:"sendKeys",path:o,value:e.key};n.sendMessage(a)}}else n.sendMessage({action:"sendKeys",path:o,value:"Keys."+e.code.toUpperCase()})},this.addClickEventListener=function(e){n.checkAndMonitorSelectElement(e.target);var t=n.xpathHelper.getActionElementXPath(e.target);if("/HTML"===t&&(t=n.xpathHelper.getElementXPath(e.target)),null!==t){var o={action:"click",path:t,value:null};n.sendMessage(o)}},this.addDoubleClickEventListener=function(e){console.log("double click!!!"),console.log(e)},this.addRightMouseListener=function(e){3!==e.which&&n.addClickEventListener(e),n.rightClickElementClicked=e.target,n.rightClickElementClicked.classList.add("tc-selected-element")},this.onChangeSelect=function(e){var t=n.xpathHelper.getElementXPath(e.target,document);n.sendMessage({value:e.target.value,action:"selectByValue",path:t})},this.xpathHelper=e,this.sendMessage=t}return e.prototype.checkAndMonitorSelectElement=function(e){"SELECT"===e.nodeName&&e.addEventListener("change",this.onChangeSelect)},e}(),a=function(){function e(){}return e.prototype.getXPath=function(e){if(e.hasAttribute("id"))return"//"+e.tagName+'[@id="'+e.id+'"]';if(e.hasAttribute("class"))return"//"+e.tagName+'[@class="'+e.getAttribute("class")+'"]';var t="/"+e.tagName;return this.getXPath(e.parentNode)+t},e.prototype.getElementXPath=function(e,t){void 0===t&&(t=void 0),null==t&&(t=document);for(var n,o,a="";e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;a=e.nodeName+"["+n+"]/"+a,e=e.parentNode}return a=(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementXPathByType=function(e,t,n){void 0===t&&(t=void 0),void 0===n&&(n="INPUT");e.cloneNode(!0);null==t&&(t=document);for(var o,a,r="",i=!0;e!==t.documentElement;){for(o=0,a=e;a;)1===a.nodeType&&a.nodeName===e.nodeName&&(o+=1),a=a.previousSibling;if(!0===i&&e&&e.nodeName==n?(r=e.nodeName+"["+o+"]/"+r,i=!1):!1===i&&(r=e.nodeName+"["+o+"]/"+r),!e)break;e=e.parentNode}return r=(r="/"+t.documentElement.nodeName+"/"+r).replace(/\/$/,"")},e.prototype.getInputElementXPath=function(e,t){return void 0===t&&(t=void 0),this.getElementXPathByType(e,t,"INPUT")},e.prototype.getActionElementXPath=function(e,t){void 0===t&&(t=void 0);e.cloneNode(!0);null==t&&(t=document);for(var n,o,a="",r=!0;e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;if(!0!==r||!e||"A"!=e.nodeName&&"BUTTON"!=e.nodeName&&"SELECT"!=e.nodeName?!1===r&&(a=e.nodeName+"["+n+"]/"+a):(a=e.nodeName+"["+n+"]/"+a,r=!1),!e)break;e=e.parentNode}return a=(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementByXPath=function(e,t){if(t||(t=document),t.evaluate)return t.evaluate(e,document,null,9,null).singleNodeValue;for(;"/"==e.charAt(0);)e=e.substr(1);for(var n=t,o=e.split("/"),a=0;a<o.length;a++){var r=o[a].split(/(\w*)\[(\d*)\]/gi).filter((function(e){return!(""==e||e.match(/\s/gi))}),this),i=r[0],s=r[1]?r[1]-1:0;if(!(a<o.length-1))return n.getElementsByTagName(i)[s];n=n.getElementsByTagName(i)[s]}},e.prototype.getElementByXPathCount=function(e,t){t||(t=document),document.evaluate("count("+e+")",t,null,XPathResult.ANY_TYPE,null)},e}(),r=function(){function e(){}return e.prototype.startMonitor=function(e){chrome.extension.connect({name:"Sample Communication"}).onMessage.addListener((function(t){"xhrStart"===t.type?e({action:t.type,value:[t.data.url,t.data.method],xhrObject:t,path:null}):"xhrDone"===t.type&&e({action:t.type,value:[t.data.url,t.data.method,t.data.statusCode],xhrObject:t,path:null})}))},e}();new(function(){function e(){var e=this;this.actionLog=[],this.isInit={startBrowserActionMonitor:!1,startXHRMonitor:!1},"true"===localStorage.getItem("isStart")&&this.sendMessageToPopup({type:"getInfo",data:{action:"isStarted"}},(function(e){!0!==e&&localStorage.setItem("isStart","false")})),chrome.runtime.onMessage.addListener((function(t,n,o){switch(t.method){case"getUrl":e.sendMessage({action:"goToUrl",value:location.href,path:null});break;case"startBrowserActionMonitor":localStorage.setItem("isStart","true"),e.startBrowserActionMonitor();break;case"startXHRMonitor":e.startXHRMonitor();break;default:throw new Error("Message method not support - add new case "+t.method)}o({successful:!0})})),this.sendMessageToPopup({type:"hello"})}return e.prototype.sendMessage=function(e){if(chrome.runtime){if(this.actionLog.length>0){var t=this.actionLog[this.actionLog.length-1];if(t.path===e.path&&"sendKeys"===t.action&&null!==e.value&&-1===e.value.indexOf("Keys."))return void this.sendUpdateMessage(e)}this.actionLog.push(e),this.sendMessageToPopup({type:"insert",data:e})}},e.prototype.sendUpdateMessage=function(e){this.sendMessageToPopup({type:"appendLastValue",data:e})},e.prototype.sendMessageToPopup=function(e,t){chrome.runtime&&chrome.runtime.sendMessage(e,(function(e){console.log(e),t(e)}))},e.prototype.startXHRMonitor=function(){!0!==this.isInit.startXHRMonitor&&(this.isInit.startXHRMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),(new r).startMonitor(this.sendMessage.bind(this)))},e.prototype.startBrowserActionMonitor=function(){!0!==this.isInit.startBrowserActionMonitor&&(this.isInit.startBrowserActionMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),this.xpathHelper=new a,new o(this.xpathHelper,this.sendMessage))},e}())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jyb3dzZXJBY3Rpb25Nb25pdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy94cGF0aEhlbHBlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvcmVxdWVzdE1vbml0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwieHBhdGhIZWxwZXIiLCJzZW5kTWVzc2FnZSIsImFkZEtleURvd25FdmVudExpc3RlbmVyIiwiZSIsImFjdGl2ZUVsZW1lbnQiLCJkb2N1bWVudCIsInhwYXRoIiwiZ2V0SW5wdXRFbGVtZW50WFBhdGgiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJhY3Rpb24iLCJwYXRoIiwic2V0VGltZW91dCIsInF1ZXJ5U2VsZWN0b3IiLCJzdWJtaXQiLCJhZGRLZXlVcEV2ZW50TGlzdGVuZXIiLCJjb2RlIiwidG9Mb3dlckNhc2UiLCJIVE1MSW5wdXRFbGVtZW50IiwiZ2V0QWN0aW9uRWxlbWVudFhQYXRoIiwiZ2V0RWxlbWVudFhQYXRoIiwiZGF0YSIsInRvVXBwZXJDYXNlIiwiYWRkQ2xpY2tFdmVudExpc3RlbmVyIiwiY2hlY2tBbmRNb25pdG9yU2VsZWN0RWxlbWVudCIsInRhcmdldCIsImFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lciIsImNvbnNvbGUiLCJsb2ciLCJhZGRSaWdodE1vdXNlTGlzdGVuZXIiLCJ3aGljaCIsInJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZCIsImNsYXNzTGlzdCIsImFkZCIsIm9uQ2hhbmdlU2VsZWN0IiwiZXZlbnQiLCJ0aGlzIiwiZWxlbWVudCIsIm5vZGVOYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImdldFhQYXRoIiwibm9kZSIsImhhc0F0dHJpYnV0ZSIsInRhZ05hbWUiLCJpZCIsImdldEF0dHJpYnV0ZSIsIm9sZCIsInBhcmVudE5vZGUiLCJkb2MiLCJ1bmRlZmluZWQiLCJwb3MiLCJ0ZW1waXRlbTIiLCJkb2N1bWVudEVsZW1lbnQiLCJub2RlVHlwZSIsInByZXZpb3VzU2libGluZyIsInJlcGxhY2UiLCJnZXRFbGVtZW50WFBhdGhCeVR5cGUiLCJ0eXBlIiwiY2xvbmVOb2RlIiwiaXNGaXJzdCIsImdldEVsZW1lbnRCeVhQYXRoIiwieFBhdGgiLCJldmFsdWF0ZSIsInNpbmdsZU5vZGVWYWx1ZSIsImNoYXJBdCIsInN1YnN0ciIsInByZXZFbGVtIiwiYXJyIiwic3BsaXQiLCJsZW5ndGgiLCJzdGVwIiwiZmlsdGVyIiwidiIsIm1hdGNoIiwiZWxlbSIsImVsZW1OdW0iLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeVhQYXRoQ291bnQiLCJYUGF0aFJlc3VsdCIsIkFOWV9UWVBFIiwic3RhcnRNb25pdG9yIiwiY2hyb21lIiwiZXh0ZW5zaW9uIiwiY29ubmVjdCIsIm9uTWVzc2FnZSIsImFkZExpc3RlbmVyIiwibXNnIiwidXJsIiwibWV0aG9kIiwieGhyT2JqZWN0Iiwic3RhdHVzQ29kZSIsImFjdGlvbkxvZyIsImlzSW5pdCIsInN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IiLCJzdGFydFhIUk1vbml0b3IiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2VuZE1lc3NhZ2VUb1BvcHVwIiwicmVzcG9uc2UiLCJzZXRJdGVtIiwicnVudGltZSIsIm1lc3NhZ2UiLCJzZW5kZXIiLCJzZW5kUmVzcG9uc2UiLCJsb2NhdGlvbiIsImhyZWYiLCJFcnJvciIsInN1Y2Nlc3NmdWwiLCJwcmV2IiwiaW5kZXhPZiIsInNlbmRVcGRhdGVNZXNzYWdlIiwicHVzaCIsImNhbGxCYWNrIiwiSlNPTiIsInN0cmluZ2lmeSIsIlJlcXVlc3Rpb25Nb25pdG9yIiwiWHBhdGhIZWxwZXIiLCJCcm93c2VyQWN0aW9uTW9uaXRvciJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04sT0FBT0MsZUFBZWIsRUFBU2lCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZWIsRUFBUyxhQUFjLENBQUVtQixPQUFPLEtBUXZEckIsRUFBb0JzQixFQUFJLFNBQVNELEVBQU9FLEdBRXZDLEdBRFUsRUFBUEEsSUFBVUYsRUFBUXJCLEVBQW9CcUIsSUFDL0IsRUFBUEUsRUFBVSxPQUFPRixFQUNw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NEMsU0FFdkQsWUFBQXlELDBCQUFSLFlBQ2tELElBQTFDekQsS0FBS3dELE9BQU9DLDRCQUdoQnpELEtBQUt3RCxPQUFPQywyQkFBNEIsRUFDeENFLGFBQWFJLFFBQVEsU0FBVWMsS0FBS0MsVUFBVTlFLEtBQUt3RCxTQUNuRHhELEtBQUtwQyxZQUFjLElBQUlvSCxFQUd2QixJQUFJQyxFQUFxQmpGLEtBQUtwQyxZQUFZb0MsS0FBS25DLGVBT3ZELEVBNUtBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7IE9wZXJhdG9yTW9kZWwgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL3NyYy9saWIvbW9kZWxzL29wZXJhdG9yTW9kZWxcIjtcclxuaW1wb3J0IHsgWHBhdGhIZWxwZXIgfSBmcm9tIFwiLi94cGF0aEhlbHBlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJyb3dzZXJBY3Rpb25Nb25pdG9yIHtcclxuICAgIHhwYXRoSGVscGVyOiBYcGF0aEhlbHBlcjtcclxuICAgIHJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZDogYW55O1xyXG4gICAgc2VuZE1lc3NhZ2U6IEZ1bmN0aW9uO1xyXG4gICAgY29uc3RydWN0b3IoeHBhdGhIZWxwZXI6WHBhdGhIZWxwZXIsc2VuZE1lc3NhZ2U6RnVuY3Rpb24pe1xyXG4gICAgICAgIHRoaXMueHBhdGhIZWxwZXI9eHBhdGhIZWxwZXI7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZT1zZW5kTWVzc2FnZTtcclxuICAgIH1cclxuICAgIGFkZEtleURvd25FdmVudExpc3RlbmVyID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0SW5wdXRFbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHsvL0VOVEVSIFxyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2VuZEtleXMnLCBwYXRoOiB4cGF0aCwgdmFsdWU6ICdLZXlzLkVOVEVSJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETyBjaGVjayBpZiBvYmplY3QgJ2UnIGNhbiBiZSByZXN1Ym1pdGVkLiAtIGlzc3VlIGNhbiBiZSB3aGVuIHlvdSBoYXZlIG1vcmUgdGhhbiAxIGZvcm1cclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm0nKS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgYWRkS2V5VXBFdmVudExpc3RlbmVyID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0SW5wdXRFbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgaWYgKGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwidGFiXCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJzaGlmdGxlZnRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcInNoaWZ0cmlnaHRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKT09J2JhY2tzcGFjZSdcclxuICAgICAgICAgICAgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJjb250cm9scmlnaHRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcImNvbnRyb2xsZWZ0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJhbHRyaWdodFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiYWx0bGVmdFwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2VuZEtleXMnLCBwYXRoOiB4cGF0aCwgdmFsdWU6ICdLZXlzLicgKyBlLmNvZGUudG9VcHBlckNhc2UoKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09IDEzKSB7XHJcbiAgICAgICAgICAgIC8vRU5URVIgaXMgaGFuZGxlciBpbiBhZGRLZXlEb3duRXZlbnRMaXN0ZW5lclxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmNvZGUgPT09IFwiQmFja3NwYWNlXCIpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2VuZEtleXMnLCBwYXRoOiB4cGF0aCwgdmFsdWU6ICdLZXlzLkJBQ0tTUEFDRSdcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGFjdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEFjdGlvbkVsZW1lbnRYUGF0aChhY3RpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgaWYgKHhwYXRoID09PSAnL0hUTUwnKSB7XHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0RWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0geyBhY3Rpb246ICdzZW5kS2V5cycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogZS5rZXkgfTtcclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhZGRDbGlja0V2ZW50TGlzdGVuZXIgPSAoZTogRXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLmNoZWNrQW5kTW9uaXRvclNlbGVjdEVsZW1lbnQoZS50YXJnZXQpO1xyXG4gICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0QWN0aW9uRWxlbWVudFhQYXRoKGUudGFyZ2V0IGFzIE5vZGUpO1xyXG4gICAgICAgIGlmICh4cGF0aCA9PT0gJy9IVE1MJykge1xyXG4gICAgICAgICAgICB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0RWxlbWVudFhQYXRoKGUudGFyZ2V0IGFzIE5vZGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoeHBhdGggPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZGF0YTogT3BlcmF0b3JNb2RlbCA9IHsgYWN0aW9uOiAnY2xpY2snLCBwYXRoOiB4cGF0aCwgdmFsdWU6IG51bGwgfVxyXG4gICAgICAgIC8vdmFyIGRhdGEgPSB7IGFjdGlvbjogJ2NsaWNrJywgcGF0aDogeHBhdGgsIHZhbHVlOiBudWxsIH1cclxuICAgICAgICAvL3RoaXMudGVtcEV2ZW50RWxlbWVudCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0RWxlbWVudEJ5WFBhdGgoeHBhdGgsIGRvY3VtZW50KTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoZGF0YSk7XHJcbiAgICB9XHJcbiAgICBhZGREb3VibGVDbGlja0V2ZW50TGlzdGVuZXIgPSAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZG91YmxlIGNsaWNrISEhXCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUpXHJcbiAgICB9XHJcbiAgICBhZGRSaWdodE1vdXNlTGlzdGVuZXIgPSAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgIGlmIChlLndoaWNoICE9PSAzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ2xpY2tFdmVudExpc3RlbmVyKGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgIHRoaXMucmlnaHRDbGlja0VsZW1lbnRDbGlja2VkLmNsYXNzTGlzdC5hZGQoXCJ0Yy1zZWxlY3RlZC1lbGVtZW50XCIpO1xyXG4gICAgICAgIC8vcmlnaHQgY2xpY2sgXHJcbiAgICB9XHJcbiAgICBjaGVja0FuZE1vbml0b3JTZWxlY3RFbGVtZW50KGVsZW1lbnQ6IGFueSkge1xyXG4gICAgICAgIGlmIChlbGVtZW50Lm5vZGVOYW1lICE9PSBcIlNFTEVDVFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vbkNoYW5nZVNlbGVjdCk7XHJcbiAgICB9XHJcbiAgICBvbkNoYW5nZVNlbGVjdCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoZXZlbnQudGFyZ2V0LCBkb2N1bWVudCk7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7IHZhbHVlOiBldmVudC50YXJnZXQudmFsdWUsIGFjdGlvbjogJ3NlbGVjdEJ5VmFsdWUnLCBwYXRoOiB4cGF0aCB9KTtcclxuXHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgWHBhdGhIZWxwZXIge1xyXG4gICAgZ2V0WFBhdGgobm9kZTogYW55KTogc3RyaW5nIHtcclxuICAgICAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJy8vJyArIG5vZGUudGFnTmFtZSArICdbQGlkPVwiJyArIG5vZGUuaWQgKyAnXCJdJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShcImNsYXNzXCIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnLy8nICsgbm9kZS50YWdOYW1lICsgJ1tAY2xhc3M9XCInICsgbm9kZS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSArICdcIl0nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIG9sZCA9ICcvJyArIG5vZGUudGFnTmFtZTtcclxuICAgICAgICBsZXQgbmV3X3BhdGggPSB0aGlzLmdldFhQYXRoKG5vZGUucGFyZW50Tm9kZSkgKyBvbGQ7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdfcGF0aDtcclxuICAgIH1cclxuICAgIGdldEVsZW1lbnRYUGF0aChub2RlOiBOb2RlIHwgbnVsbCwgZG9jOiBEb2N1bWVudCA9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGlmIChkb2MgPT0gdW5kZWZpbmVkKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSAnJztcclxuICAgICAgICB2YXIgcG9zLCB0ZW1waXRlbTI7XHJcbiAgICAgICAgd2hpbGUgKG5vZGUgIT09IGRvYy5kb2N1bWVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcG9zID0gMDsgdGVtcGl0ZW0yID0gbm9kZTtcclxuICAgICAgICAgICAgd2hpbGUgKHRlbXBpdGVtMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBpdGVtMi5ub2RlVHlwZSA9PT0gMSAmJiB0ZW1waXRlbTIubm9kZU5hbWUgPT09IG5vZGUhLm5vZGVOYW1lKSB7IHBvcyArPSAxOyB9XHJcbiAgICAgICAgICAgICAgICB0ZW1waXRlbTIgPSB0ZW1waXRlbTIucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHhwYXRoID0gbm9kZSEubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgbm9kZSA9IG5vZGUhLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhwYXRoID0gJy8nICsgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSArICcvJyArIHhwYXRoO1xyXG4gICAgICAgIHhwYXRoID0geHBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuICAgICAgICByZXR1cm4geHBhdGg7XHJcbiAgICB9XHJcbiAgICBnZXRFbGVtZW50WFBhdGhCeVR5cGUobm9kZTogTm9kZSB8IG51bGwsIGRvYzogRG9jdW1lbnQgPSB1bmRlZmluZWQsIHR5cGU6IHN0cmluZz0nSU5QVVQnKSB7XHJcbiAgICAgICAgdmFyIG5vZGVDbG9uZSA9IG5vZGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgIGlmIChkb2MgPT0gdW5kZWZpbmVkKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSAnJztcclxuICAgICAgICB2YXIgaXNGaXJzdCA9IHRydWU7XHJcbiAgICAgICAgdmFyIHBvcywgdGVtcGl0ZW0yO1xyXG4gICAgICAgIHdoaWxlIChub2RlICE9PSBkb2MuZG9jdW1lbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHBvcyA9IDA7IHRlbXBpdGVtMiA9IG5vZGU7XHJcbiAgICAgICAgICAgIHdoaWxlICh0ZW1waXRlbTIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1waXRlbTIubm9kZVR5cGUgPT09IDEgJiYgdGVtcGl0ZW0yLm5vZGVOYW1lID09PSBub2RlLm5vZGVOYW1lKSB7IHBvcyArPSAxOyB9XHJcbiAgICAgICAgICAgICAgICB0ZW1waXRlbTIgPSB0ZW1waXRlbTIucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc0ZpcnN0ID09PSB0cnVlICYmIG5vZGUgJiYgKG5vZGUubm9kZU5hbWUgPT0gdHlwZSkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgICAgIC8vIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgb3BlblNlbGVjdE9wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIC8vcmV0dXJuIG51bGw7IC0+IHJldHVybiBudWxsIGlzIGJhZCBpZGVhIGJlY2F1c2UgaXQgd2lsbCBcclxuICAgICAgICAgICAgICAgIC8vIH0gZWxzZSBpZiAobm9kZS5ub2RlTmFtZSA9PSAnU0VMRUNUJyAmJiBvcGVuU2VsZWN0T3BlbiA9PT0gdHJ1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ZpcnN0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgeHBhdGggPSBub2RlLm5vZGVOYW1lICsgJ1snICsgcG9zICsgJ10nICsgJy8nICsgeHBhdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB4cGF0aCA9ICcvJyArIGRvYy5kb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICB4cGF0aCA9IHhwYXRoLnJlcGxhY2UoL1xcLyQvLCAnJyk7XHJcbiAgICAgICAgLy8gaWYoeHBhdGg9PT0nL0hUTUwnKXtcclxuICAgICAgICAvLyAgICAgdmFyIHJldFZhbCA9Y29uZmlybShcIkVsZW1lbnQgaXMgbm90IGFjdGlvbiBlbGVtZW50LCBkbyB5b3Ugd2FudCB0byBnZXQgbm90IGFjdGl2ZSBlbGVtZW50P1wiKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIGlmKCByZXRWYWwgPT0gdHJ1ZSApIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEVsZW1lbnRYUGF0aChub2RlQ2xvbmUsZG9jKTtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgIC8vIFx0XHRcdCAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIC8vIFx0XHQgICB9XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiB4cGF0aDtcclxuICAgIH1cclxuICAgIGdldElucHV0RWxlbWVudFhQYXRoKG5vZGU6IE5vZGUgfCBudWxsLCBkb2M6IERvY3VtZW50ID0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudFhQYXRoQnlUeXBlKG5vZGUsZG9jLFwiSU5QVVRcIik7XHJcbiAgICB9XHJcbiAgICBnZXRBY3Rpb25FbGVtZW50WFBhdGgobm9kZTogTm9kZSB8IG51bGwsIGRvYzogRG9jdW1lbnQgPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgdmFyIG5vZGVDbG9uZSA9IG5vZGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgIGlmIChkb2MgPT0gdW5kZWZpbmVkKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSAnJztcclxuICAgICAgICB2YXIgaXNGaXJzdCA9IHRydWU7XHJcbiAgICAgICAgdmFyIHBvcywgdGVtcGl0ZW0yO1xyXG4gICAgICAgIHdoaWxlIChub2RlICE9PSBkb2MuZG9jdW1lbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHBvcyA9IDA7IHRlbXBpdGVtMiA9IG5vZGU7XHJcbiAgICAgICAgICAgIHdoaWxlICh0ZW1waXRlbTIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1waXRlbTIubm9kZVR5cGUgPT09IDEgJiYgdGVtcGl0ZW0yLm5vZGVOYW1lID09PSBub2RlLm5vZGVOYW1lKSB7IHBvcyArPSAxOyB9XHJcbiAgICAgICAgICAgICAgICB0ZW1waXRlbTIgPSB0ZW1waXRlbTIucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc0ZpcnN0ID09PSB0cnVlICYmIG5vZGUgJiYgKG5vZGUubm9kZU5hbWUgPT0gJ0EnIHx8IG5vZGUubm9kZU5hbWUgPT0gJ0JVVFRPTicgfHwgbm9kZS5ub2RlTmFtZSA9PSAnU0VMRUNUJykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgICAgIC8vIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgb3BlblNlbGVjdE9wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIC8vcmV0dXJuIG51bGw7IC0+IHJldHVybiBudWxsIGlzIGJhZCBpZGVhIGJlY2F1c2UgaXQgd2lsbCBcclxuICAgICAgICAgICAgICAgIC8vIH0gZWxzZSBpZiAobm9kZS5ub2RlTmFtZSA9PSAnU0VMRUNUJyAmJiBvcGVuU2VsZWN0T3BlbiA9PT0gdHJ1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ZpcnN0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgeHBhdGggPSBub2RlLm5vZGVOYW1lICsgJ1snICsgcG9zICsgJ10nICsgJy8nICsgeHBhdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB4cGF0aCA9ICcvJyArIGRvYy5kb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICB4cGF0aCA9IHhwYXRoLnJlcGxhY2UoL1xcLyQvLCAnJyk7XHJcbiAgICAgICAgLy8gaWYoeHBhdGg9PT0nL0hUTUwnKXtcclxuICAgICAgICAvLyAgICAgdmFyIHJldFZhbCA9Y29uZmlybShcIkVsZW1lbnQgaXMgbm90IGFjdGlvbiBlbGVtZW50LCBkbyB5b3Ugd2FudCB0byBnZXQgbm90IGFjdGl2ZSBlbGVtZW50P1wiKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIGlmKCByZXRWYWwgPT0gdHJ1ZSApIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEVsZW1lbnRYUGF0aChub2RlQ2xvbmUsZG9jKTtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgIC8vIFx0XHRcdCAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIC8vIFx0XHQgICB9XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiB4cGF0aDtcclxuICAgIH1cclxuICAgIGdldEVsZW1lbnRCeVhQYXRoKHhQYXRoOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQpOiBhbnkge1xyXG4gICAgICAgIGlmICghZG9jKSBkb2MgPSBkb2N1bWVudDtcclxuICAgICAgICBpZiAoZG9jLmV2YWx1YXRlKSByZXR1cm4gZG9jLmV2YWx1YXRlKHhQYXRoLCBkb2N1bWVudCwgbnVsbCwgOSwgbnVsbCkuc2luZ2xlTm9kZVZhbHVlO1xyXG4gICAgICAgIC8vIGZvciBJRVxyXG4gICAgICAgIHdoaWxlICh4UGF0aC5jaGFyQXQoMCkgPT0gJy8nKSB4UGF0aCA9IHhQYXRoLnN1YnN0cigxKTtcclxuICAgICAgICB2YXIgcHJldkVsZW0gPSBkb2M7XHJcbiAgICAgICAgdmFyIGFyciA9IHhQYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHN0ZXA6IGFueSA9IGFycltpXS5zcGxpdCgvKFxcdyopXFxbKFxcZCopXFxdL2dpKS5maWx0ZXIoKHYpID0+IHsgcmV0dXJuICEodiA9PSAnJyB8fCB2Lm1hdGNoKC9cXHMvZ2kpKSB9LCB0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGVsZW0gPSBzdGVwWzBdO1xyXG4gICAgICAgICAgICB2YXIgZWxlbU51bSA9IHN0ZXBbMV0gPyBzdGVwWzFdIC0gMSA6IDA7IC8vIC0xIHNpbmNlIHhwYXRoIGlzIDEgYmFzZWRcclxuICAgICAgICAgICAgaWYgKGkgPCBhcnIubGVuZ3RoIC0gMSkgcHJldkVsZW0gPSBwcmV2RWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZShlbGVtKVtlbGVtTnVtXTtcclxuICAgICAgICAgICAgZWxzZSByZXR1cm4gcHJldkVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoZWxlbSlbZWxlbU51bV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0RWxlbWVudEJ5WFBhdGhDb3VudCh4UGF0aDogc3RyaW5nLCBkb2M6IERvY3VtZW50KSB7XHJcbiAgICAgICAgaWYgKCFkb2MpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIGRvY3VtZW50LmV2YWx1YXRlKFwiY291bnQoXCIgKyB4UGF0aCArIFwiKVwiLCBkb2MsIG51bGwsIFhQYXRoUmVzdWx0LkFOWV9UWVBFLCBudWxsKTtcclxuICAgIH1cclxufSIsIlxyXG5leHBvcnQgY2xhc3MgUmVxdWVzdGlvbk1vbml0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgfVxyXG4gICAgc3RhcnRNb25pdG9yKHNlbmRNZXNzYWdlKSB7XHJcblxyXG4gICAgICAgIHZhciBwb3J0ID0gKDxhbnk+Y2hyb21lKS5leHRlbnNpb24uY29ubmVjdCh7XHJcbiAgICAgICAgICAgIG5hbWU6IFwiU2FtcGxlIENvbW11bmljYXRpb25cIlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBwb3J0Lm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3hoclN0YXJ0Jykge1xyXG4gICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogbXNnLnR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFttc2cuZGF0YS51cmwsIG1zZy5kYXRhLm1ldGhvZF0sXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyT2JqZWN0Om1zZyxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChtc2cudHlwZSA9PT0gJ3hockRvbmUnKSB7XHJcbiAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBtc2cudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW21zZy5kYXRhLnVybCwgbXNnLmRhdGEubWV0aG9kLCBtc2cuZGF0YS5zdGF0dXNDb2RlXSxcclxuICAgICAgICAgICAgICAgICAgICB4aHJPYmplY3Q6bXNnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IG51bGxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQge01haW59IGZyb20gJy4vbWFpbic7XHJcbm5ldyBNYWluKCk7XHJcblxyXG4iLCJpbXBvcnQgeyBPcGVyYXRvck1vZGVsIH0gZnJvbSBcIi4uLy4uL3NoYXJlZC9zcmMvbGliL21vZGVscy9vcGVyYXRvck1vZGVsXCI7XHJcbmltcG9ydCB7IEJyb3dzZXJBY3Rpb25Nb25pdG9yIH0gZnJvbSBcIi4vYnJvd3NlckFjdGlvbk1vbml0b3JcIjtcclxuaW1wb3J0IHsgWHBhdGhIZWxwZXIgfSBmcm9tIFwiLi94cGF0aEhlbHBlclwiO1xyXG5pbXBvcnQgeyBSZXF1ZXN0aW9uTW9uaXRvciB9IGZyb20gXCIuL3JlcXVlc3RNb25pdG9yXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTWFpbiB7XHJcbiAgICB4cGF0aEhlbHBlcjogWHBhdGhIZWxwZXI7XHJcbiAgIC8vIHRlbXBFdmVudEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgdGVtcEVsZW1lbnRWYWx1ZTogc3RyaW5nO1xyXG4gICAgcmlnaHRDbGlja0VsZW1lbnRDbGlja2VkOiBIVE1MRWxlbWVudDtcclxuICAgIGFjdGlvbkxvZzogT3BlcmF0b3JNb2RlbFtdID0gW107XHJcblxyXG4gICAgaXNJbml0OiB7IHN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IsIHN0YXJ0WEhSTW9uaXRvciB9ID0geyBzdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yOiBmYWxzZSwgc3RhcnRYSFJNb25pdG9yOiBmYWxzZSB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaXNTdGFydCcpID09PSAndHJ1ZScpIHtcclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2dldEluZm8nLCBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnaXNTdGFydGVkJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAhPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc1N0YXJ0JywgJ2ZhbHNlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1lc3NhZ2U6IGFueSwgc2VuZGVyOiBhbnksIHNlbmRSZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZS5tZXRob2QpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2dldFVybCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dvVG9VcmwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbG9jYXRpb24uaHJlZixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3InOlxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc1N0YXJ0JywgJ3RydWUnKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N0YXJ0WEhSTW9uaXRvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFhIUk1vbml0b3IoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWVzc2FnZSBtZXRob2Qgbm90IHN1cHBvcnQgLSBhZGQgbmV3IGNhc2UgXCIgKyBtZXNzYWdlLm1ldGhvZCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlbmRSZXNwb25zZSh7IHN1Y2Nlc3NmdWw6IHRydWUgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9Qb3B1cCh7IHR5cGU6ICdoZWxsbycgfSk7XHJcbiAgICB9XHJcbiAgICAvLyBhZGRLZXlEb3duRXZlbnRMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAvLyAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIC8vICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldElucHV0RWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgIC8vICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7Ly9FTlRFUiBcclxuICAgIC8vICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgLy8gICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgIC8vICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy5FTlRFUidcclxuICAgIC8vICAgICAgICAgfSlcclxuICAgIC8vICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAvLyAgICAgICAgICAgICAvL1RPRE8gY2hlY2sgaWYgb2JqZWN0ICdlJyBjYW4gYmUgcmVzdWJtaXRlZC4gLSBpc3N1ZSBjYW4gYmUgd2hlbiB5b3UgaGF2ZSBtb3JlIHRoYW4gMSBmb3JtXHJcbiAgICAvLyAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtJykuc3VibWl0KCk7XHJcbiAgICAvLyAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfTtcclxuICAgIC8vIGFkZEtleVVwRXZlbnRMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAvLyAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIC8vICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldElucHV0RWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgLy8gICAgIGlmIChlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcInRhYlwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwic2hpZnRsZWZ0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJzaGlmdHJpZ2h0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCk9PSdiYWNrc3BhY2UnXHJcbiAgICAvLyAgICAgICAgIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiY29udHJvbHJpZ2h0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJjb250cm9sbGVmdFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiYWx0cmlnaHRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcImFsdGxlZnRcIikge1xyXG4gICAgLy8gICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgIC8vICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy4nICsgZS5jb2RlLnRvVXBwZXJDYXNlKClcclxuICAgIC8vICAgICAgICAgfSk7XHJcbiAgICAvLyAgICAgICAgIHJldHVybjtcclxuICAgIC8vICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAxMykge1xyXG4gICAgLy8gICAgICAgICAvL0VOVEVSIGlzIGhhbmRsZXIgaW4gYWRkS2V5RG93bkV2ZW50TGlzdGVuZXJcclxuICAgIC8vICAgICAgICAgcmV0dXJuO1xyXG4gICAgLy8gICAgIH0gZWxzZSBpZiAoZS5jb2RlID09PSBcIkJhY2tzcGFjZVwiKSB7XHJcblxyXG4gICAgLy8gICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgIC8vICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy5CQUNLU1BBQ0UnXHJcbiAgICAvLyAgICAgICAgIH0pXHJcblxyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICBlbHNlIGlmIChhY3RpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkge1xyXG5cclxuICAgIC8vICAgICAgICAgdmFyIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRBY3Rpb25FbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcbiAgICAvLyAgICAgICAgIGlmICh4cGF0aCA9PT0gJy9IVE1MJykge1xyXG4gICAgLy8gICAgICAgICAgICAgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEVsZW1lbnRYUGF0aChhY3RpdmVFbGVtZW50KTtcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICBsZXQgZGF0YSA9IHsgYWN0aW9uOiAnc2VuZEtleXMnLCBwYXRoOiB4cGF0aCwgdmFsdWU6IGUua2V5IH07XHJcbiAgICAvLyAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoZGF0YSk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG4gICAgLy8gYWRkQ2xpY2tFdmVudExpc3RlbmVyID0gKGU6IEV2ZW50KSA9PiB7XHJcbiAgICAvLyAgICAgdGhpcy5jaGVja0FuZE1vbml0b3JTZWxlY3RFbGVtZW50KGUudGFyZ2V0KTtcclxuICAgIC8vICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEFjdGlvbkVsZW1lbnRYUGF0aChlLnRhcmdldCBhcyBOb2RlKTtcclxuICAgIC8vICAgICBpZiAoeHBhdGggPT09ICcvSFRNTCcpIHtcclxuICAgIC8vICAgICAgICAgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldEVsZW1lbnRYUGF0aChlLnRhcmdldCBhcyBOb2RlKTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgaWYgKHhwYXRoID09PSBudWxsKSB7XHJcbiAgICAvLyAgICAgICAgIHJldHVybjtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgdmFyIGRhdGE6IE9wZXJhdG9yTW9kZWwgPSB7IGFjdGlvbjogJ2NsaWNrJywgcGF0aDogeHBhdGgsIHZhbHVlOiBudWxsIH1cclxuXHJcbiAgICAvLyAgICAgdGhpcy50ZW1wRXZlbnRFbGVtZW50ID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50QnlYUGF0aCh4cGF0aCwgZG9jdW1lbnQpO1xyXG5cclxuXHJcbiAgICAvLyAgICAgdGhpcy5zZW5kTWVzc2FnZShkYXRhKTtcclxuICAgIC8vIH1cclxuICAgIC8vIGFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coXCJkb3VibGUgY2xpY2shISFcIik7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coZSlcclxuICAgIC8vIH1cclxuICAgIC8vIGFkZFJpZ2h0TW91c2VMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAvLyAgICAgaWYgKGUud2hpY2ggIT09IDMpIHtcclxuICAgIC8vICAgICAgICAgdGhpcy5hZGRDbGlja0V2ZW50TGlzdGVuZXIoZSk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICAgIHRoaXMucmlnaHRDbGlja0VsZW1lbnRDbGlja2VkID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAvLyAgICAgdGhpcy5yaWdodENsaWNrRWxlbWVudENsaWNrZWQuY2xhc3NMaXN0LmFkZChcInRjLXNlbGVjdGVkLWVsZW1lbnRcIik7XHJcbiAgICAvLyAgICAgLy9yaWdodCBjbGljayBcclxuICAgIC8vIH1cclxuXHJcbiAgICBzZW5kTWVzc2FnZShkYXRhOiBPcGVyYXRvck1vZGVsKSB7XHJcbiAgICAgICAgaWYgKCFjaHJvbWUucnVudGltZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmFjdGlvbkxvZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLmFjdGlvbkxvZ1t0aGlzLmFjdGlvbkxvZy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgaWYgKHByZXYucGF0aCA9PT0gZGF0YS5wYXRoICYmIHByZXYuYWN0aW9uID09PSAnc2VuZEtleXMnICYmIChkYXRhLnZhbHVlICE9PSBudWxsICYmIGRhdGEudmFsdWUuaW5kZXhPZignS2V5cy4nKSA9PT0gLTEpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRVcGRhdGVNZXNzYWdlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWN0aW9uTG9nLnB1c2goZGF0YSk7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoeyB0eXBlOiAnaW5zZXJ0JywgZGF0YTogZGF0YSB9KTtcclxuXHJcbiAgICB9XHJcbiAgICBzZW5kVXBkYXRlTWVzc2FnZShkYXRhOiBPcGVyYXRvck1vZGVsKSB7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoeyB0eXBlOiAnYXBwZW5kTGFzdFZhbHVlJywgZGF0YTogZGF0YSB9KTtcclxuXHJcbiAgICB9XHJcbiAgICBzZW5kTWVzc2FnZVRvUG9wdXAobWVzc2FnZSwgY2FsbEJhY2s/KSB7XHJcbiAgICAgICAgaWYgKGNocm9tZS5ydW50aW1lKSB7XHJcbiAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKG1lc3NhZ2UsIGZ1bmN0aW9uIChyZXNwb25zZTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICBjYWxsQmFjayhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgXHJcbiAgICBcclxuICAgIHByaXZhdGUgc3RhcnRYSFJNb25pdG9yKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzSW5pdC5zdGFydFhIUk1vbml0b3IgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzSW5pdC5zdGFydFhIUk1vbml0b3IgPSB0cnVlO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc0luaXQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmlzSW5pdCkpO1xyXG4gICAgICAgIG5ldyBSZXF1ZXN0aW9uTW9uaXRvcigpLnN0YXJ0TW9uaXRvcih0aGlzLnNlbmRNZXNzYWdlLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzSW5pdC5zdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0luaXQuc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvciA9IHRydWU7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2lzSW5pdCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuaXNJbml0KSk7XHJcbiAgICAgICAgdGhpcy54cGF0aEhlbHBlciA9IG5ldyBYcGF0aEhlbHBlcigpO1xyXG4gICAgICBcclxuICAgICAgICBcclxuICAgICAgICBuZXcgQnJvd3NlckFjdGlvbk1vbml0b3IodGhpcy54cGF0aEhlbHBlcix0aGlzLnNlbmRNZXNzYWdlKTtcclxuICAgICAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuYWRkUmlnaHRNb3VzZUxpc3RlbmVyKTtcclxuXHJcbiAgICAgICAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuYWRkS2V5VXBFdmVudExpc3RlbmVyKTtcclxuICAgICAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmFkZEtleURvd25FdmVudExpc3RlbmVyKTtcclxuICAgICAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgdGhpcy5hZGREb3VibGVDbGlja0V2ZW50TGlzdGVuZXIpO1xyXG4gICAgfVxyXG59XHJcbiAgIFxyXG4iXSwic291cmNlUm9vdCI6IiJ9