!function(){"use strict";var e=function(){function e(e,t){var n=this;this.addKeyDownEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);"Enter"==e.key&&(e.preventDefault(),n.sendMessage({action:"sendKeys",path:o,value:"Keys.ENTER"}),setTimeout((function(){document.querySelector("form").submit()}),100))},this.addKeyUpEventListener=function(e){var t=document.activeElement,o=n.xpathHelper.getInputElementXPath(t);if("tab"!=e.code.toLowerCase()&&"shiftleft"!=e.code.toLowerCase()&&"shiftright"!=e.code.toLowerCase()&&"backspace"!=e.code.toLowerCase()&&"controlright"!=e.code.toLowerCase()&&"controlleft"!=e.code.toLowerCase()&&"altright"!=e.code.toLowerCase()&&"altleft"!=e.code.toLowerCase()){if("Enter"!=e.key)if("Backspace"===e.code)n.sendMessage({action:"sendKeys",path:o,value:"Keys.BACKSPACE"});else if(t instanceof HTMLInputElement){"/HTML"===(o=n.xpathHelper.getActionElementXPath(t))&&(o=n.xpathHelper.getElementXPath(t));var a={action:"sendKeys",path:o,value:e.key};n.sendMessage(a)}}else n.sendMessage({action:"sendKeys",path:o,value:"Keys."+e.code.toUpperCase()})},this.addClickEventListener=function(e){n.checkAndMonitorSelectElement(e.target);var t=n.xpathHelper.getActionElementXPath(e.target);if("/HTML"===t&&(t=n.xpathHelper.getElementXPath(e.target)),null!==t){var o={action:"click",path:t,value:null};n.sendMessage(o)}},this.addDoubleClickEventListener=function(e){console.log("double click!!!"),console.log(e)},this.addMouseListener=function(e){3!==e.which&&n.addClickEventListener(e),n.rightClickElementClicked=e.target,n.rightClickElementClicked.classList.add("tc-selected-element")},this.onChangeSelect=function(e){var t=n.xpathHelper.getElementXPath(e.target,document);n.sendMessage({value:e.target.value,action:"selectByValue",path:t})},this.xpathHelper=e,this.sendMessage=t,null==document.ondblclick&&(document.onkeyup=this.addKeyUpEventListener,document.onkeydown=this.addKeyDownEventListener,document.ondblclick=this.addDoubleClickEventListener,document.onmousedown=this.addMouseListener)}return e.prototype.checkAndMonitorSelectElement=function(e){"SELECT"===e.nodeName&&e.addEventListener("change",this.onChangeSelect)},e}(),t=function(){function e(){}return e.prototype.getXPath=function(e){if(e.hasAttribute("id"))return"//"+e.tagName+'[@id="'+e.id+'"]';if(e.hasAttribute("class"))return"//"+e.tagName+'[@class="'+e.getAttribute("class")+'"]';var t="/"+e.tagName;return this.getXPath(e.parentNode)+t},e.prototype.getElementXPath=function(e,t){void 0===t&&(t=void 0),null==t&&(t=document);for(var n,o,a="";e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;a=e.nodeName+"["+n+"]/"+a,e=e.parentNode}return(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementXPathByType=function(e,t,n){void 0===t&&(t=void 0),void 0===n&&(n="INPUT"),e.cloneNode(!0),null==t&&(t=document);for(var o,a,s="",i=!0;e!==t.documentElement;){for(o=0,a=e;a;)1===a.nodeType&&a.nodeName===e.nodeName&&(o+=1),a=a.previousSibling;if(!0===i&&e&&e.nodeName==n?(s=e.nodeName+"["+o+"]/"+s,i=!1):!1===i&&(s=e.nodeName+"["+o+"]/"+s),!e)break;e=e.parentNode}return(s="/"+t.documentElement.nodeName+"/"+s).replace(/\/$/,"")},e.prototype.getInputElementXPath=function(e,t){return void 0===t&&(t=void 0),this.getElementXPathByType(e,t,"INPUT")},e.prototype.getActionElementXPath=function(e,t){void 0===t&&(t=void 0),e.cloneNode(!0),null==t&&(t=document);for(var n,o,a="",s=!0;e!==t.documentElement;){for(n=0,o=e;o;)1===o.nodeType&&o.nodeName===e.nodeName&&(n+=1),o=o.previousSibling;if(!0!==s||!e||"A"!=e.nodeName&&"BUTTON"!=e.nodeName&&"SELECT"!=e.nodeName?!1===s&&(a=e.nodeName+"["+n+"]/"+a):(a=e.nodeName+"["+n+"]/"+a,s=!1),!e)break;e=e.parentNode}return(a="/"+t.documentElement.nodeName+"/"+a).replace(/\/$/,"")},e.prototype.getElementByXPath=function(e,t){if(t||(t=document),t.evaluate)return t.evaluate(e,document,null,9,null).singleNodeValue;for(;"/"==e.charAt(0);)e=e.substr(1);for(var n=t,o=e.split("/"),a=0;a<o.length;a++){var s=o[a].split(/(\w*)\[(\d*)\]/gi).filter((function(e){return!(""==e||e.match(/\s/gi))}),this),i=s[0],r=s[1]?s[1]-1:0;if(!(a<o.length-1))return n.getElementsByTagName(i)[r];n=n.getElementsByTagName(i)[r]}},e.prototype.getElementByXPathCount=function(e,t){t||(t=document),document.evaluate("count("+e+")",t,null,XPathResult.ANY_TYPE,null)},e}(),n=function(){function e(){}return e.prototype.startMonitor=function(e){chrome.extension.connect({name:"Sample Communication"}).onMessage.addListener((function(t){"xhrStart"===t.type?e({action:t.type,value:[t.data.url,t.data.method],xhrObject:t,path:null}):"xhrDone"===t.type&&e({action:t.type,value:[t.data.url,t.data.method,t.data.statusCode],xhrObject:t,path:null})}))},e}();new(function(){function o(){this.actionLog=[],this.isInit={startBrowserActionMonitor:!1,startXHRMonitor:!1},"true"===localStorage.getItem("isStart")&&this.sendMessageToPopup({type:"getInfo",data:{action:"isStarted"}},(function(e){!0!==e&&localStorage.setItem("isStart","false")})),0==chrome.runtime.onMessage.hasListener(this.onMessage.bind(this))&&chrome.runtime.onMessage.addListener(this.onMessage.bind(this)),this.sendMessageToPopup({type:"hello"})}return o.prototype.onMessage=function(e,t,n){switch(e.method){case"getUrl":this.sendMessage({action:"goToUrl",value:location.href,path:null}),n(location.href);break;case"startBrowserActionMonitor":localStorage.setItem("isStart","true"),this.startBrowserActionMonitor();break;case"startXHRMonitor":this.startXHRMonitor();break;default:throw new Error("Message method not support - add new case "+e.method)}n({successful:!0})},o.prototype.sendMessage=function(e){if(chrome.runtime){if(this.actionLog.length>0){var t=this.actionLog[this.actionLog.length-1],n=null!==t.data.value&&0===t.data.value.indexOf("Keys."),o=null!==e.value&&0===e.value.indexOf("Keys.");if(t.data.path===e.path&&"sendKeys"===t.data.action&&!n&&!o)return void this.sendUpdateMessage(e)}var a={type:"insert",data:e};this.actionLog.push(a),this.sendMessageToPopup(a)}},o.prototype.sendUpdateMessage=function(e){var t={type:"appendLastValue",data:e};this.sendMessageToPopup(t),this.actionLog.push(t)},o.prototype.sendMessageToPopup=function(e,t){chrome.runtime&&chrome.runtime.sendMessage(e,(function(e){console.log(e),t&&t(e)}))},o.prototype.startXHRMonitor=function(){!0!==this.isInit.startXHRMonitor&&(this.isInit.startXHRMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),(new n).startMonitor(this.sendMessage.bind(this)))},o.prototype.startBrowserActionMonitor=function(){!0!==this.isInit.startBrowserActionMonitor&&(this.isInit.startBrowserActionMonitor=!0,localStorage.setItem("isInit",JSON.stringify(this.isInit)),this.xpathHelper=new t,new e(this.xpathHelper,this.sendMessage.bind(this)))},o}())}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvYnJvd3NlckFjdGlvbk1vbml0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3hwYXRoSGVscGVyLnRzIiwid2VicGFjazovLy8uL3NyYy9yZXF1ZXN0TW9uaXRvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21haW4udHMiXSwibmFtZXMiOlsieHBhdGhIZWxwZXIiLCJzZW5kTWVzc2FnZSIsImFkZEtleURvd25FdmVudExpc3RlbmVyIiwiZSIsImFjdGl2ZUVsZW1lbnQiLCJkb2N1bWVudCIsInhwYXRoIiwiZ2V0SW5wdXRFbGVtZW50WFBhdGgiLCJrZXkiLCJwcmV2ZW50RGVmYXVsdCIsImFjdGlvbiIsInBhdGgiLCJ2YWx1ZSIsInNldFRpbWVvdXQiLCJxdWVyeVNlbGVjdG9yIiwic3VibWl0IiwiYWRkS2V5VXBFdmVudExpc3RlbmVyIiwiY29kZSIsInRvTG93ZXJDYXNlIiwiSFRNTElucHV0RWxlbWVudCIsImdldEFjdGlvbkVsZW1lbnRYUGF0aCIsImdldEVsZW1lbnRYUGF0aCIsImRhdGEiLCJ0b1VwcGVyQ2FzZSIsImFkZENsaWNrRXZlbnRMaXN0ZW5lciIsImNoZWNrQW5kTW9uaXRvclNlbGVjdEVsZW1lbnQiLCJ0YXJnZXQiLCJhZGREb3VibGVDbGlja0V2ZW50TGlzdGVuZXIiLCJjb25zb2xlIiwibG9nIiwiYWRkTW91c2VMaXN0ZW5lciIsIndoaWNoIiwicmlnaHRDbGlja0VsZW1lbnRDbGlja2VkIiwiY2xhc3NMaXN0IiwiYWRkIiwib25DaGFuZ2VTZWxlY3QiLCJldmVudCIsInRoaXMiLCJvbmRibGNsaWNrIiwib25rZXl1cCIsIm9ua2V5ZG93biIsIm9ubW91c2Vkb3duIiwiZWxlbWVudCIsIm5vZGVOYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImdldFhQYXRoIiwibm9kZSIsImhhc0F0dHJpYnV0ZSIsInRhZ05hbWUiLCJpZCIsImdldEF0dHJpYnV0ZSIsIm9sZCIsInBhcmVudE5vZGUiLCJkb2MiLCJ1bmRlZmluZWQiLCJwb3MiLCJ0ZW1waXRlbTIiLCJkb2N1bWVudEVsZW1lbnQiLCJub2RlVHlwZSIsInByZXZpb3VzU2libGluZyIsInJlcGxhY2UiLCJnZXRFbGVtZW50WFBhdGhCeVR5cGUiLCJ0eXBlIiwiY2xvbmVOb2RlIiwiaXNGaXJzdCIsImdldEVsZW1lbnRCeVhQYXRoIiwieFBhdGgiLCJldmFsdWF0ZSIsInNpbmdsZU5vZGVWYWx1ZSIsImNoYXJBdCIsInN1YnN0ciIsInByZXZFbGVtIiwiYXJyIiwic3BsaXQiLCJpIiwibGVuZ3RoIiwic3RlcCIsImZpbHRlciIsInYiLCJtYXRjaCIsImVsZW0iLCJlbGVtTnVtIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJnZXRFbGVtZW50QnlYUGF0aENvdW50IiwiWFBhdGhSZXN1bHQiLCJBTllfVFlQRSIsInN0YXJ0TW9uaXRvciIsImNocm9tZSIsImV4dGVuc2lvbiIsImNvbm5lY3QiLCJuYW1lIiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJtc2ciLCJ1cmwiLCJtZXRob2QiLCJ4aHJPYmplY3QiLCJzdGF0dXNDb2RlIiwiYWN0aW9uTG9nIiwiaXNJbml0Iiwic3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvciIsInN0YXJ0WEhSTW9uaXRvciIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZW5kTWVzc2FnZVRvUG9wdXAiLCJyZXNwb25zZSIsInNldEl0ZW0iLCJydW50aW1lIiwiaGFzTGlzdGVuZXIiLCJiaW5kIiwibWVzc2FnZSIsInNlbmRlciIsInNlbmRSZXNwb25zZSIsImxvY2F0aW9uIiwiaHJlZiIsIkVycm9yIiwic3VjY2Vzc2Z1bCIsInByZXYiLCJpc1ByZXZLZXlzIiwiaW5kZXhPZiIsImlzQ3VycmVudEtleXMiLCJzZW5kVXBkYXRlTWVzc2FnZSIsInB1c2giLCJjYWxsQmFjayIsIkpTT04iLCJzdHJpbmdpZnkiLCJSZXF1ZXN0aW9uTW9uaXRvciIsIlhwYXRoSGVscGVyIiwiQnJvd3NlckFjdGlvbk1vbml0b3IiXSwibWFwcGluZ3MiOiJ5QkFHQSxpQkFJSSxXQUFZQSxFQUEwQkMsR0FBdEMsV0FhQSxLQUFBQyx3QkFBMEIsU0FBQ0MsR0FDdkIsSUFBTUMsRUFBZ0JDLFNBQVNELGNBQzNCRSxFQUFRLEVBQUtOLFlBQVlPLHFCQUFxQkgsR0FFckMsU0FBVEQsRUFBRUssTUFDRkwsRUFBRU0saUJBQ0YsRUFBS1IsWUFBWSxDQUNiUyxPQUFRLFdBQVlDLEtBQU1MLEVBQU9NLE1BQU8sZUFFNUNDLFlBQVcsV0FFUFIsU0FBU1MsY0FBYyxRQUFRQyxXQUNoQyxPQUdYLEtBQUFDLHNCQUF3QixTQUFDYixHQUNyQixJQUFNQyxFQUFnQkMsU0FBU0QsY0FDM0JFLEVBQVEsRUFBS04sWUFBWU8scUJBQXFCSCxHQUNsRCxHQUE0QixPQUF4QkQsRUFBRWMsS0FBS0MsZUFBa0QsYUFBeEJmLEVBQUVjLEtBQUtDLGVBQXdELGNBQXhCZixFQUFFYyxLQUFLQyxlQUF5RCxhQUF4QmYsRUFBRWMsS0FBS0MsZUFDNUYsZ0JBQXhCZixFQUFFYyxLQUFLQyxlQUEyRCxlQUF4QmYsRUFBRWMsS0FBS0MsZUFBMEQsWUFBeEJmLEVBQUVjLEtBQUtDLGVBQXVELFdBQXhCZixFQUFFYyxLQUFLQyxlQUtoSSxHQUFhLFNBQVRmLEVBQUVLLElBR04sR0FBZSxjQUFYTCxFQUFFYyxLQUVULEVBQUtoQixZQUFZLENBQ2JTLE9BQVEsV0FBWUMsS0FBTUwsRUFBT00sTUFBTyx3QkFJM0MsR0FBSVIsYUFBeUJlLGlCQUFrQixDQUdsQyxXQURWYixFQUFRLEVBQUtOLFlBQVlvQixzQkFBc0JoQixNQUUvQ0UsRUFBUSxFQUFLTixZQUFZcUIsZ0JBQWdCakIsSUFFN0MsSUFBSWtCLEVBQU8sQ0FBRVosT0FBUSxXQUFZQyxLQUFNTCxFQUFPTSxNQUFPVCxFQUFFSyxLQUN2RCxFQUFLUCxZQUFZcUIsU0FyQmpCLEVBQUtyQixZQUFZLENBQ2JTLE9BQVEsV0FBWUMsS0FBTUwsRUFBT00sTUFBTyxRQUFVVCxFQUFFYyxLQUFLTSxpQkF1QnJFLEtBQUFDLHNCQUF3QixTQUFDckIsR0FDckIsRUFBS3NCLDZCQUE2QnRCLEVBQUV1QixRQUNwQyxJQUFJcEIsRUFBUSxFQUFLTixZQUFZb0Isc0JBQXNCakIsRUFBRXVCLFFBSXJELEdBSGMsVUFBVnBCLElBQ0FBLEVBQVEsRUFBS04sWUFBWXFCLGdCQUFnQmxCLEVBQUV1QixTQUVqQyxPQUFWcEIsRUFBSixDQUdBLElBQUlnQixFQUFzQixDQUFFWixPQUFRLFFBQVNDLEtBQU1MLEVBQU9NLE1BQU8sTUFLakUsRUFBS1gsWUFBWXFCLEtBRXJCLEtBQUFLLDRCQUE4QixTQUFDeEIsR0FDM0J5QixRQUFRQyxJQUFJLG1CQUNaRCxRQUFRQyxJQUFJMUIsSUFFaEIsS0FBQTJCLGlCQUFtQixTQUFDM0IsR0FDQSxJQUFaQSxFQUFFNEIsT0FDRixFQUFLUCxzQkFBc0JyQixHQUUvQixFQUFLNkIseUJBQTJCN0IsRUFBRXVCLE9BQ2xDLEVBQUtNLHlCQUF5QkMsVUFBVUMsSUFBSSx3QkFVaEQsS0FBQUMsZUFBaUIsU0FBQ0MsR0FDZCxJQUFNOUIsRUFBUSxFQUFLTixZQUFZcUIsZ0JBQWdCZSxFQUFNVixPQUFRckIsVUFDN0QsRUFBS0osWUFBWSxDQUFFVyxNQUFPd0IsRUFBTVYsT0FBT2QsTUFBT0YsT0FBUSxnQkFBaUJDLEtBQU1MLEtBN0Y3RStCLEtBQUtyQyxZQUFjQSxFQUNuQnFDLEtBQUtwQyxZQUFjQSxFQUNRLE1BQXZCSSxTQUFTaUMsYUFHYmpDLFNBQVNrQyxRQUFVRixLQUFLckIsc0JBQ3hCWCxTQUFTbUMsVUFBWUgsS0FBS25DLHdCQUMxQkcsU0FBU2lDLFdBQWFELEtBQUtWLDRCQUMzQnRCLFNBQVNvQyxZQUFjSixLQUFLUCxrQkF3RnBDLE9BWkksWUFBQUwsNkJBQUEsU0FBNkJpQixHQUNBLFdBQXJCQSxFQUFRQyxVQUlaRCxFQUFRRSxpQkFBaUIsU0FBVVAsS0FBS0YsaUJBT2hELEVBckdBLEdDSEEsMkJBNElBLE9BMUlJLFlBQUFVLFNBQUEsU0FBU0MsR0FDTCxHQUFJQSxFQUFLQyxhQUFhLE1BQ2xCLE1BQU8sS0FBT0QsRUFBS0UsUUFBVSxTQUFXRixFQUFLRyxHQUFLLEtBR3RELEdBQUlILEVBQUtDLGFBQWEsU0FDbEIsTUFBTyxLQUFPRCxFQUFLRSxRQUFVLFlBQWNGLEVBQUtJLGFBQWEsU0FBVyxLQUc1RSxJQUFJQyxFQUFNLElBQU1MLEVBQUtFLFFBR3JCLE9BRmVYLEtBQUtRLFNBQVNDLEVBQUtNLFlBQWNELEdBSXBELFlBQUE5QixnQkFBQSxTQUFnQnlCLEVBQW1CTyxRQUFBLElBQUFBLFdBQUEsR0FDcEJDLE1BQVBELElBQWtCQSxFQUFNaEQsVUFHNUIsSUFGQSxJQUNJa0QsRUFBS0MsRUFETGxELEVBQVEsR0FFTHdDLElBQVNPLEVBQUlJLGlCQUFpQixDQUVqQyxJQURBRixFQUFNLEVBQUdDLEVBQVlWLEVBQ2RVLEdBQ3dCLElBQXZCQSxFQUFVRSxVQUFrQkYsRUFBVWIsV0FBYUcsRUFBTUgsV0FBWVksR0FBTyxHQUNoRkMsRUFBWUEsRUFBVUcsZ0JBRTFCckQsRUFBUXdDLEVBQU1ILFNBQVcsSUFBTVksRUFBdkJULEtBQXlDeEMsRUFDakR3QyxFQUFPQSxFQUFNTSxXQUlqQixPQUZBOUMsRUFBUSxJQUFNK0MsRUFBSUksZ0JBQWdCZCxTQUFXLElBQU1yQyxHQUNyQ3NELFFBQVEsTUFBTyxLQUdqQyxZQUFBQyxzQkFBQSxTQUFzQmYsRUFBbUJPLEVBQTJCUyxRQUEzQixJQUFBVCxXQUFBLFFBQTJCLElBQUFTLE1BQUEsU0FDaERoQixFQUFLaUIsV0FBVSxHQUNwQlQsTUFBUEQsSUFBa0JBLEVBQU1oRCxVQUk1QixJQUhBLElBRUlrRCxFQUFLQyxFQUZMbEQsRUFBUSxHQUNSMEQsR0FBVSxFQUVQbEIsSUFBU08sRUFBSUksaUJBQWlCLENBRWpDLElBREFGLEVBQU0sRUFBR0MsRUFBWVYsRUFDZFUsR0FDd0IsSUFBdkJBLEVBQVVFLFVBQWtCRixFQUFVYixXQUFhRyxFQUFLSCxXQUFZWSxHQUFPLEdBQy9FQyxFQUFZQSxFQUFVRyxnQkFlMUIsSUFiZ0IsSUFBWkssR0FBb0JsQixHQUFTQSxFQUFLSCxVQUFZbUIsR0FFOUN4RCxFQUFRd0MsRUFBS0gsU0FBVyxJQUFNWSxFQUF0QlQsS0FBd0N4QyxFQU9oRDBELEdBQVUsSUFDUyxJQUFaQSxJQUNQMUQsRUFBUXdDLEVBQUtILFNBQVcsSUFBTVksRUFBdEJULEtBQXdDeEMsSUFFL0N3QyxFQUNELE1BRUpBLEVBQU9BLEVBQUtNLFdBWWhCLE9BVkE5QyxFQUFRLElBQU0rQyxFQUFJSSxnQkFBZ0JkLFNBQVcsSUFBTXJDLEdBQ3JDc0QsUUFBUSxNQUFPLEtBV2pDLFlBQUFyRCxxQkFBQSxTQUFxQnVDLEVBQW1CTyxHQUNwQyxZQURvQyxJQUFBQSxXQUFBLEdBQzdCaEIsS0FBS3dCLHNCQUFzQmYsRUFBS08sRUFBSSxVQUUvQyxZQUFBakMsc0JBQUEsU0FBc0IwQixFQUFtQk8sUUFBQSxJQUFBQSxXQUFBLEdBRXJCUCxFQUFLaUIsV0FBVSxHQUNwQlQsTUFBUEQsSUFBa0JBLEVBQU1oRCxVQUk1QixJQUhBLElBRUlrRCxFQUFLQyxFQUZMbEQsRUFBUSxHQUNSMEQsR0FBVSxFQUVQbEIsSUFBU08sRUFBSUksaUJBQWlCLENBRWpDLElBREFGLEVBQU0sRUFBR0MsRUFBWVYsRUFDZFUsR0FDd0IsSUFBdkJBLEVBQVVFLFVBQWtCRixFQUFVYixXQUFhRyxFQUFLSCxXQUFZWSxHQUFPLEdBQy9FQyxFQUFZQSxFQUFVRyxnQkFlMUIsSUFiZ0IsSUFBWkssSUFBb0JsQixHQUEwQixLQUFqQkEsRUFBS0gsVUFBb0MsVUFBakJHLEVBQUtILFVBQXlDLFVBQWpCRyxFQUFLSCxVQVVwRSxJQUFacUIsSUFDUDFELEVBQVF3QyxFQUFLSCxTQUFXLElBQU1ZLEVBQXRCVCxLQUF3Q3hDLElBVGhEQSxFQUFRd0MsRUFBS0gsU0FBVyxJQUFNWSxFQUF0QlQsS0FBd0N4QyxFQU9oRDBELEdBQVUsSUFJVGxCLEVBQ0QsTUFFSkEsRUFBT0EsRUFBS00sV0FZaEIsT0FWQTlDLEVBQVEsSUFBTStDLEVBQUlJLGdCQUFnQmQsU0FBVyxJQUFNckMsR0FDckNzRCxRQUFRLE1BQU8sS0FXakMsWUFBQUssa0JBQUEsU0FBa0JDLEVBQWViLEdBRTdCLEdBREtBLElBQUtBLEVBQU1oRCxVQUNaZ0QsRUFBSWMsU0FBVSxPQUFPZCxFQUFJYyxTQUFTRCxFQUFPN0QsU0FBVSxLQUFNLEVBQUcsTUFBTStELGdCQUV0RSxLQUEwQixLQUFuQkYsRUFBTUcsT0FBTyxJQUFXSCxFQUFRQSxFQUFNSSxPQUFPLEdBR3BELElBRkEsSUFBSUMsRUFBV2xCLEVBQ1htQixFQUFNTixFQUFNTyxNQUFNLEtBQ2JDLEVBQUksRUFBR0EsRUFBSUYsRUFBSUcsT0FBUUQsSUFBSyxDQUNqQyxJQUFJRSxFQUFZSixFQUFJRSxHQUFHRCxNQUFNLG9CQUFvQkksUUFBTyxTQUFDQyxHQUFRLFFBQWMsSUFBTEEsR0FBV0EsRUFBRUMsTUFBTSxXQUFZMUMsTUFDckcyQyxFQUFPSixFQUFLLEdBQ1pLLEVBQVVMLEVBQUssR0FBS0EsRUFBSyxHQUFLLEVBQUksRUFDdEMsS0FBSUYsRUFBSUYsRUFBSUcsT0FBUyxHQUNoQixPQUFPSixFQUFTVyxxQkFBcUJGLEdBQU1DLEdBRHhCVixFQUFXQSxFQUFTVyxxQkFBcUJGLEdBQU1DLEtBSS9FLFlBQUFFLHVCQUFBLFNBQXVCakIsRUFBZWIsR0FDN0JBLElBQUtBLEVBQU1oRCxVQUNoQkEsU0FBUzhELFNBQVMsU0FBV0QsRUFBUSxJQUFLYixFQUFLLEtBQU0rQixZQUFZQyxTQUFVLE9BRW5GLEVBNUlBLEdDQ0EsYUFDSSxjQTBCSixPQXhCSSxZQUFBQyxhQUFBLFNBQWFyRixHQUVRc0YsT0FBUUMsVUFBVUMsUUFBUSxDQUN2Q0MsS0FBTSx5QkFHTEMsVUFBVUMsYUFBWSxTQUFVQyxHQUNoQixhQUFiQSxFQUFJL0IsS0FDSjdELEVBQVksQ0FDUlMsT0FBUW1GLEVBQUkvQixLQUNabEQsTUFBTyxDQUFDaUYsRUFBSXZFLEtBQUt3RSxJQUFLRCxFQUFJdkUsS0FBS3lFLFFBQy9CQyxVQUFVSCxFQUNWbEYsS0FBTSxPQUVVLFlBQWJrRixFQUFJL0IsTUFDWDdELEVBQVksQ0FDUlMsT0FBUW1GLEVBQUkvQixLQUNabEQsTUFBTyxDQUFDaUYsRUFBSXZFLEtBQUt3RSxJQUFLRCxFQUFJdkUsS0FBS3lFLE9BQVFGLEVBQUl2RSxLQUFLMkUsWUFDaERELFVBQVVILEVBQ1ZsRixLQUFNLFdBSzFCLEVBM0JBLEdDQUEsSUNJQSxXQVVJLGFBSkEsS0FBQXVGLFVBQXFELEdBRXJELEtBQUFDLE9BQXlELENBQUVDLDJCQUEyQixFQUFPQyxpQkFBaUIsR0FHbEUsU0FBcENDLGFBQWFDLFFBQVEsWUFDckJsRSxLQUFLbUUsbUJBQW1CLENBQ3BCMUMsS0FBTSxVQUFXeEMsS0FBTSxDQUNuQlosT0FBUSxlQUViLFNBQUMrRixJQUNpQixJQUFiQSxHQUNBSCxhQUFhSSxRQUFRLFVBQVcsWUFJMkIsR0FBbkVuQixPQUFPb0IsUUFBUWhCLFVBQVVpQixZQUFZdkUsS0FBS3NELFVBQVVrQixLQUFLeEUsUUFDekRrRCxPQUFPb0IsUUFBUWhCLFVBQVVDLFlBQVl2RCxLQUFLc0QsVUFBVWtCLEtBQUt4RSxPQUc3REEsS0FBS21FLG1CQUFtQixDQUFFMUMsS0FBTSxVQW1GeEMsT0FqRkksWUFBQTZCLFVBQUEsU0FBVW1CLEVBQWNDLEVBQWFDLEdBQ2pDLE9BQVFGLEVBQVFmLFFBQ1osSUFBSyxTQUNEMUQsS0FBS3BDLFlBQVksQ0FDYlMsT0FBUSxVQUNSRSxNQUFPcUcsU0FBU0MsS0FDaEJ2RyxLQUFNLE9BRVZxRyxFQUFhQyxTQUFTQyxNQUN0QixNQUNKLElBQUssNEJBQ0RaLGFBQWFJLFFBQVEsVUFBVyxRQUNoQ3JFLEtBQUsrRCw0QkFDTCxNQUNKLElBQUssa0JBQ0QvRCxLQUFLZ0Usa0JBQ0wsTUFDSixRQUNJLE1BQU0sSUFBSWMsTUFBTSw2Q0FBK0NMLEVBQVFmLFFBRy9FaUIsRUFBYSxDQUFFSSxZQUFZLEtBRS9CLFlBQUFuSCxZQUFBLFNBQVlxQixHQUNSLEdBQUtpRSxPQUFPb0IsUUFBWixDQUdBLEdBQUl0RSxLQUFLNkQsVUFBVXZCLE9BQVMsRUFBRyxDQUMzQixJQUFNMEMsRUFBT2hGLEtBQUs2RCxVQUFVN0QsS0FBSzZELFVBQVV2QixPQUFTLEdBQzlDMkMsRUFBaUMsT0FBcEJELEVBQUsvRixLQUFLVixPQUF1RCxJQUFyQ3lHLEVBQUsvRixLQUFLVixNQUFNMkcsUUFBUSxTQUNqRUMsRUFBK0IsT0FBZmxHLEVBQUtWLE9BQWtELElBQWhDVSxFQUFLVixNQUFNMkcsUUFBUSxTQUNoRSxHQUFJRixFQUFLL0YsS0FBS1gsT0FBU1csRUFBS1gsTUFBNkIsYUFBckIwRyxFQUFLL0YsS0FBS1osU0FBMEI0RyxJQUMvREUsRUFFRCxZQURBbkYsS0FBS29GLGtCQUFrQm5HLEdBS25DLElBQUlaLEVBQVMsQ0FBRW9ELEtBQU0sU0FBVXhDLEtBQU1BLEdBRXJDZSxLQUFLNkQsVUFBVXdCLEtBQUtoSCxHQUNwQjJCLEtBQUttRSxtQkFBbUI5RixLQUc1QixZQUFBK0csa0JBQUEsU0FBa0JuRyxHQUNkLElBQUlaLEVBQVMsQ0FBRW9ELEtBQU0sa0JBQW1CeEMsS0FBTUEsR0FDOUNlLEtBQUttRSxtQkFBbUI5RixHQUN4QjJCLEtBQUs2RCxVQUFVd0IsS0FBS2hILElBR3hCLFlBQUE4RixtQkFBQSxTQUFtQk0sRUFBU2EsR0FDcEJwQyxPQUFPb0IsU0FDUHBCLE9BQU9vQixRQUFRMUcsWUFBWTZHLEdBQVMsU0FBVUwsR0FDMUM3RSxRQUFRQyxJQUFJNEUsR0FDTmtCLEdBQ0ZBLEVBQVNsQixPQU1qQixZQUFBSixnQkFBUixZQUN3QyxJQUFoQ2hFLEtBQUs4RCxPQUFPRSxrQkFHaEJoRSxLQUFLOEQsT0FBT0UsaUJBQWtCLEVBQzlCQyxhQUFhSSxRQUFRLFNBQVVrQixLQUFLQyxVQUFVeEYsS0FBSzhELFVBQ25ELElBQUkyQixHQUFvQnhDLGFBQWFqRCxLQUFLcEMsWUFBWTRHLEtBQUt4RSxTQUUvRCxZQUFBK0QsMEJBQUEsWUFDa0QsSUFBMUMvRCxLQUFLOEQsT0FBT0MsNEJBR2hCL0QsS0FBSzhELE9BQU9DLDJCQUE0QixFQUN4Q0UsYUFBYUksUUFBUSxTQUFVa0IsS0FBS0MsVUFBVXhGLEtBQUs4RCxTQUNuRDlELEtBQUtyQyxZQUFjLElBQUkrSCxFQUd2QixJQUFJQyxFQUFxQjNGLEtBQUtyQyxZQUFhcUMsS0FBS3BDLFlBQVk0RyxLQUFLeEUsU0FHekUsRUE3R0EsSSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcGVyYXRvck1vZGVsIH0gZnJvbSBcIi4uLy4uL3NoYXJlZC9zcmMvbGliL21vZGVscy9vcGVyYXRvck1vZGVsXCI7XHJcbmltcG9ydCB7IFhwYXRoSGVscGVyIH0gZnJvbSBcIi4veHBhdGhIZWxwZXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBCcm93c2VyQWN0aW9uTW9uaXRvciB7XHJcbiAgICB4cGF0aEhlbHBlcjogWHBhdGhIZWxwZXI7XHJcbiAgICByaWdodENsaWNrRWxlbWVudENsaWNrZWQ6IGFueTtcclxuICAgIHNlbmRNZXNzYWdlOiBGdW5jdGlvbjtcclxuICAgIGNvbnN0cnVjdG9yKHhwYXRoSGVscGVyOiBYcGF0aEhlbHBlciwgc2VuZE1lc3NhZ2U6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy54cGF0aEhlbHBlciA9IHhwYXRoSGVscGVyO1xyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UgPSBzZW5kTWVzc2FnZTtcclxuICAgICAgICBpZiAoZG9jdW1lbnQub25kYmxjbGljayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZG9jdW1lbnQub25rZXl1cCA9IHRoaXMuYWRkS2V5VXBFdmVudExpc3RlbmVyO1xyXG4gICAgICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9IHRoaXMuYWRkS2V5RG93bkV2ZW50TGlzdGVuZXI7XHJcbiAgICAgICAgZG9jdW1lbnQub25kYmxjbGljayA9IHRoaXMuYWRkRG91YmxlQ2xpY2tFdmVudExpc3RlbmVyO1xyXG4gICAgICAgIGRvY3VtZW50Lm9ubW91c2Vkb3duID0gdGhpcy5hZGRNb3VzZUxpc3RlbmVyO1xyXG5cclxuXHJcbiAgICB9XHJcbiAgICBhZGRLZXlEb3duRXZlbnRMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICB2YXIgeHBhdGggPSB0aGlzLnhwYXRoSGVscGVyLmdldElucHV0RWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICBpZiAoZS5rZXkgPT0gJ0VudGVyJykgey8vRU5URVIgXHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZW5kS2V5cycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogJ0tleXMuRU5URVInXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9UT0RPIGNoZWNrIGlmIG9iamVjdCAnZScgY2FuIGJlIHJlc3VibWl0ZWQuIC0gaXNzdWUgY2FuIGJlIHdoZW4geW91IGhhdmUgbW9yZSB0aGFuIDEgZm9ybVxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybScpLnN1Ym1pdCgpO1xyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBhZGRLZXlVcEV2ZW50TGlzdGVuZXIgPSAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGFjdGl2ZUVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgdmFyIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRJbnB1dEVsZW1lbnRYUGF0aChhY3RpdmVFbGVtZW50KTtcclxuICAgICAgICBpZiAoZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJ0YWJcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcInNoaWZ0bGVmdFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwic2hpZnRyaWdodFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09ICdiYWNrc3BhY2UnXHJcbiAgICAgICAgICAgIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiY29udHJvbHJpZ2h0XCIgfHwgZS5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJjb250cm9sbGVmdFwiIHx8IGUuY29kZS50b0xvd2VyQ2FzZSgpID09IFwiYWx0cmlnaHRcIiB8fCBlLmNvZGUudG9Mb3dlckNhc2UoKSA9PSBcImFsdGxlZnRcIikge1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiAnS2V5cy4nICsgZS5jb2RlLnRvVXBwZXJDYXNlKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGUua2V5ID09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgLy9FTlRFUiBpcyBoYW5kbGVyIGluIGFkZEtleURvd25FdmVudExpc3RlbmVyXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGUuY29kZSA9PT0gXCJCYWNrc3BhY2VcIikge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZW5kS2V5cycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogJ0tleXMuQkFDS1NQQUNFJ1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYWN0aXZlRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB4cGF0aCA9IHRoaXMueHBhdGhIZWxwZXIuZ2V0QWN0aW9uRWxlbWVudFhQYXRoKGFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBpZiAoeHBhdGggPT09ICcvSFRNTCcpIHtcclxuICAgICAgICAgICAgICAgIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoYWN0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB7IGFjdGlvbjogJ3NlbmRLZXlzJywgcGF0aDogeHBhdGgsIHZhbHVlOiBlLmtleSB9O1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFkZENsaWNrRXZlbnRMaXN0ZW5lciA9IChlOiBFdmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2hlY2tBbmRNb25pdG9yU2VsZWN0RWxlbWVudChlLnRhcmdldCk7XHJcbiAgICAgICAgdmFyIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRBY3Rpb25FbGVtZW50WFBhdGgoZS50YXJnZXQgYXMgTm9kZSk7XHJcbiAgICAgICAgaWYgKHhwYXRoID09PSAnL0hUTUwnKSB7XHJcbiAgICAgICAgICAgIHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoZS50YXJnZXQgYXMgTm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh4cGF0aCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBkYXRhOiBPcGVyYXRvck1vZGVsID0geyBhY3Rpb246ICdjbGljaycsIHBhdGg6IHhwYXRoLCB2YWx1ZTogbnVsbCB9XHJcbiAgICAgICAgLy92YXIgZGF0YSA9IHsgYWN0aW9uOiAnY2xpY2snLCBwYXRoOiB4cGF0aCwgdmFsdWU6IG51bGwgfVxyXG4gICAgICAgIC8vdGhpcy50ZW1wRXZlbnRFbGVtZW50ID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50QnlYUGF0aCh4cGF0aCwgZG9jdW1lbnQpO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShkYXRhKTtcclxuICAgIH1cclxuICAgIGFkZERvdWJsZUNsaWNrRXZlbnRMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJkb3VibGUgY2xpY2shISFcIik7XHJcbiAgICAgICAgY29uc29sZS5sb2coZSlcclxuICAgIH1cclxuICAgIGFkZE1vdXNlTGlzdGVuZXIgPSAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgIGlmIChlLndoaWNoICE9PSAzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ2xpY2tFdmVudExpc3RlbmVyKGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJpZ2h0Q2xpY2tFbGVtZW50Q2xpY2tlZCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgIHRoaXMucmlnaHRDbGlja0VsZW1lbnRDbGlja2VkLmNsYXNzTGlzdC5hZGQoXCJ0Yy1zZWxlY3RlZC1lbGVtZW50XCIpO1xyXG4gICAgICAgIC8vcmlnaHQgY2xpY2sgXHJcbiAgICB9XHJcbiAgICBjaGVja0FuZE1vbml0b3JTZWxlY3RFbGVtZW50KGVsZW1lbnQ6IGFueSkge1xyXG4gICAgICAgIGlmIChlbGVtZW50Lm5vZGVOYW1lICE9PSBcIlNFTEVDVFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vbkNoYW5nZVNlbGVjdCk7XHJcbiAgICB9XHJcbiAgICBvbkNoYW5nZVNlbGVjdCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHhwYXRoID0gdGhpcy54cGF0aEhlbHBlci5nZXRFbGVtZW50WFBhdGgoZXZlbnQudGFyZ2V0LCBkb2N1bWVudCk7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7IHZhbHVlOiBldmVudC50YXJnZXQudmFsdWUsIGFjdGlvbjogJ3NlbGVjdEJ5VmFsdWUnLCBwYXRoOiB4cGF0aCB9KTtcclxuXHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgWHBhdGhIZWxwZXIge1xyXG4gICAgXHJcbiAgICBnZXRYUGF0aChub2RlOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnLy8nICsgbm9kZS50YWdOYW1lICsgJ1tAaWQ9XCInICsgbm9kZS5pZCArICdcIl0nO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlKFwiY2xhc3NcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcvLycgKyBub2RlLnRhZ05hbWUgKyAnW0BjbGFzcz1cIicgKyBub2RlLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpICsgJ1wiXSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgb2xkID0gJy8nICsgbm9kZS50YWdOYW1lO1xyXG4gICAgICAgIGxldCBuZXdfcGF0aCA9IHRoaXMuZ2V0WFBhdGgobm9kZS5wYXJlbnROb2RlKSArIG9sZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld19wYXRoO1xyXG4gICAgfVxyXG4gICAgZ2V0RWxlbWVudFhQYXRoKG5vZGU6IE5vZGUgfCBudWxsLCBkb2M6IERvY3VtZW50ID0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKGRvYyA9PSB1bmRlZmluZWQpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9ICcnO1xyXG4gICAgICAgIHZhciBwb3MsIHRlbXBpdGVtMjtcclxuICAgICAgICB3aGlsZSAobm9kZSAhPT0gZG9jLmRvY3VtZW50RWxlbWVudCkge1xyXG4gICAgICAgICAgICBwb3MgPSAwOyB0ZW1waXRlbTIgPSBub2RlO1xyXG4gICAgICAgICAgICB3aGlsZSAodGVtcGl0ZW0yKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcGl0ZW0yLm5vZGVUeXBlID09PSAxICYmIHRlbXBpdGVtMi5ub2RlTmFtZSA9PT0gbm9kZSEubm9kZU5hbWUpIHsgcG9zICs9IDE7IH1cclxuICAgICAgICAgICAgICAgIHRlbXBpdGVtMiA9IHRlbXBpdGVtMi5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeHBhdGggPSBub2RlIS5ub2RlTmFtZSArICdbJyArIHBvcyArICddJyArICcvJyArIHhwYXRoO1xyXG4gICAgICAgICAgICBub2RlID0gbm9kZSEucGFyZW50Tm9kZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgeHBhdGggPSAnLycgKyBkb2MuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICsgJy8nICsgeHBhdGg7XHJcbiAgICAgICAgeHBhdGggPSB4cGF0aC5yZXBsYWNlKC9cXC8kLywgJycpO1xyXG4gICAgICAgIHJldHVybiB4cGF0aDtcclxuICAgIH1cclxuICAgIGdldEVsZW1lbnRYUGF0aEJ5VHlwZShub2RlOiBOb2RlIHwgbnVsbCwgZG9jOiBEb2N1bWVudCA9IHVuZGVmaW5lZCwgdHlwZTogc3RyaW5nPSdJTlBVVCcpIHtcclxuICAgICAgICB2YXIgbm9kZUNsb25lID0gbm9kZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGRvYyA9PSB1bmRlZmluZWQpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9ICcnO1xyXG4gICAgICAgIHZhciBpc0ZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICB2YXIgcG9zLCB0ZW1waXRlbTI7XHJcbiAgICAgICAgd2hpbGUgKG5vZGUgIT09IGRvYy5kb2N1bWVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcG9zID0gMDsgdGVtcGl0ZW0yID0gbm9kZTtcclxuICAgICAgICAgICAgd2hpbGUgKHRlbXBpdGVtMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBpdGVtMi5ub2RlVHlwZSA9PT0gMSAmJiB0ZW1waXRlbTIubm9kZU5hbWUgPT09IG5vZGUubm9kZU5hbWUpIHsgcG9zICs9IDE7IH1cclxuICAgICAgICAgICAgICAgIHRlbXBpdGVtMiA9IHRlbXBpdGVtMi5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzRmlyc3QgPT09IHRydWUgJiYgbm9kZSAmJiAobm9kZS5ub2RlTmFtZSA9PSB0eXBlKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHhwYXRoID0gbm9kZS5ub2RlTmFtZSArICdbJyArIHBvcyArICddJyArICcvJyArIHhwYXRoO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgKG5vZGUubm9kZU5hbWUgPT0gJ1NFTEVDVCcgJiYgb3BlblNlbGVjdE9wZW4gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBvcGVuU2VsZWN0T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgLy9yZXR1cm4gbnVsbDsgLT4gcmV0dXJuIG51bGwgaXMgYmFkIGlkZWEgYmVjYXVzZSBpdCB3aWxsIFxyXG4gICAgICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSB0cnVlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzRmlyc3QgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhwYXRoID0gJy8nICsgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSArICcvJyArIHhwYXRoO1xyXG4gICAgICAgIHhwYXRoID0geHBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuICAgICAgICAvLyBpZih4cGF0aD09PScvSFRNTCcpe1xyXG4gICAgICAgIC8vICAgICB2YXIgcmV0VmFsID1jb25maXJtKFwiRWxlbWVudCBpcyBub3QgYWN0aW9uIGVsZW1lbnQsIGRvIHlvdSB3YW50IHRvIGdldCBub3QgYWN0aXZlIGVsZW1lbnQ/XCIpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgaWYoIHJldFZhbCA9PSB0cnVlICkge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudFhQYXRoKG5vZGVDbG9uZSxkb2MpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgLy8gXHRcdFx0ICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgLy8gXHRcdCAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHhwYXRoO1xyXG4gICAgfVxyXG4gICAgZ2V0SW5wdXRFbGVtZW50WFBhdGgobm9kZTogTm9kZSB8IG51bGwsIGRvYzogRG9jdW1lbnQgPSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRFbGVtZW50WFBhdGhCeVR5cGUobm9kZSxkb2MsXCJJTlBVVFwiKTtcclxuICAgIH1cclxuICAgIGdldEFjdGlvbkVsZW1lbnRYUGF0aChub2RlOiBOb2RlIHwgbnVsbCwgZG9jOiBEb2N1bWVudCA9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICB2YXIgbm9kZUNsb25lID0gbm9kZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGRvYyA9PSB1bmRlZmluZWQpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIHZhciB4cGF0aCA9ICcnO1xyXG4gICAgICAgIHZhciBpc0ZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICB2YXIgcG9zLCB0ZW1waXRlbTI7XHJcbiAgICAgICAgd2hpbGUgKG5vZGUgIT09IGRvYy5kb2N1bWVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcG9zID0gMDsgdGVtcGl0ZW0yID0gbm9kZTtcclxuICAgICAgICAgICAgd2hpbGUgKHRlbXBpdGVtMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBpdGVtMi5ub2RlVHlwZSA9PT0gMSAmJiB0ZW1waXRlbTIubm9kZU5hbWUgPT09IG5vZGUubm9kZU5hbWUpIHsgcG9zICs9IDE7IH1cclxuICAgICAgICAgICAgICAgIHRlbXBpdGVtMiA9IHRlbXBpdGVtMi5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzRmlyc3QgPT09IHRydWUgJiYgbm9kZSAmJiAobm9kZS5ub2RlTmFtZSA9PSAnQScgfHwgbm9kZS5ub2RlTmFtZSA9PSAnQlVUVE9OJyB8fCBub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHhwYXRoID0gbm9kZS5ub2RlTmFtZSArICdbJyArIHBvcyArICddJyArICcvJyArIHhwYXRoO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgKG5vZGUubm9kZU5hbWUgPT0gJ1NFTEVDVCcgJiYgb3BlblNlbGVjdE9wZW4gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBvcGVuU2VsZWN0T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgLy9yZXR1cm4gbnVsbDsgLT4gcmV0dXJuIG51bGwgaXMgYmFkIGlkZWEgYmVjYXVzZSBpdCB3aWxsIFxyXG4gICAgICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChub2RlLm5vZGVOYW1lID09ICdTRUxFQ1QnICYmIG9wZW5TZWxlY3RPcGVuID09PSB0cnVlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzRmlyc3QgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB4cGF0aCA9IG5vZGUubm9kZU5hbWUgKyAnWycgKyBwb3MgKyAnXScgKyAnLycgKyB4cGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHhwYXRoID0gJy8nICsgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSArICcvJyArIHhwYXRoO1xyXG4gICAgICAgIHhwYXRoID0geHBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuICAgICAgICAvLyBpZih4cGF0aD09PScvSFRNTCcpe1xyXG4gICAgICAgIC8vICAgICB2YXIgcmV0VmFsID1jb25maXJtKFwiRWxlbWVudCBpcyBub3QgYWN0aW9uIGVsZW1lbnQsIGRvIHlvdSB3YW50IHRvIGdldCBub3QgYWN0aXZlIGVsZW1lbnQ/XCIpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgaWYoIHJldFZhbCA9PSB0cnVlICkge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudFhQYXRoKG5vZGVDbG9uZSxkb2MpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgLy8gXHRcdFx0ICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgLy8gXHRcdCAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHhwYXRoO1xyXG4gICAgfVxyXG4gICAgZ2V0RWxlbWVudEJ5WFBhdGgoeFBhdGg6IHN0cmluZywgZG9jOiBEb2N1bWVudCk6IGFueSB7XHJcbiAgICAgICAgaWYgKCFkb2MpIGRvYyA9IGRvY3VtZW50O1xyXG4gICAgICAgIGlmIChkb2MuZXZhbHVhdGUpIHJldHVybiBkb2MuZXZhbHVhdGUoeFBhdGgsIGRvY3VtZW50LCBudWxsLCA5LCBudWxsKS5zaW5nbGVOb2RlVmFsdWU7XHJcbiAgICAgICAgLy8gZm9yIElFXHJcbiAgICAgICAgd2hpbGUgKHhQYXRoLmNoYXJBdCgwKSA9PSAnLycpIHhQYXRoID0geFBhdGguc3Vic3RyKDEpO1xyXG4gICAgICAgIHZhciBwcmV2RWxlbSA9IGRvYztcclxuICAgICAgICB2YXIgYXJyID0geFBhdGguc3BsaXQoJy8nKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgc3RlcDogYW55ID0gYXJyW2ldLnNwbGl0KC8oXFx3KilcXFsoXFxkKilcXF0vZ2kpLmZpbHRlcigodikgPT4geyByZXR1cm4gISh2ID09ICcnIHx8IHYubWF0Y2goL1xccy9naSkpIH0sIHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgZWxlbSA9IHN0ZXBbMF07XHJcbiAgICAgICAgICAgIHZhciBlbGVtTnVtID0gc3RlcFsxXSA/IHN0ZXBbMV0gLSAxIDogMDsgLy8gLTEgc2luY2UgeHBhdGggaXMgMSBiYXNlZFxyXG4gICAgICAgICAgICBpZiAoaSA8IGFyci5sZW5ndGggLSAxKSBwcmV2RWxlbSA9IHByZXZFbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKGVsZW0pW2VsZW1OdW1dO1xyXG4gICAgICAgICAgICBlbHNlIHJldHVybiBwcmV2RWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZShlbGVtKVtlbGVtTnVtXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRFbGVtZW50QnlYUGF0aENvdW50KHhQYXRoOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQpIHtcclxuICAgICAgICBpZiAoIWRvYykgZG9jID0gZG9jdW1lbnQ7XHJcbiAgICAgICAgZG9jdW1lbnQuZXZhbHVhdGUoXCJjb3VudChcIiArIHhQYXRoICsgXCIpXCIsIGRvYywgbnVsbCwgWFBhdGhSZXN1bHQuQU5ZX1RZUEUsIG51bGwpO1xyXG4gICAgfVxyXG59IiwiXHJcbmV4cG9ydCBjbGFzcyBSZXF1ZXN0aW9uTW9uaXRvciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIH1cclxuICAgIHN0YXJ0TW9uaXRvcihzZW5kTWVzc2FnZSkge1xyXG5cclxuICAgICAgICB2YXIgcG9ydCA9ICg8YW55PmNocm9tZSkuZXh0ZW5zaW9uLmNvbm5lY3Qoe1xyXG4gICAgICAgICAgICBuYW1lOiBcIlNhbXBsZSBDb21tdW5pY2F0aW9uXCJcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcG9ydC5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgICAgICBpZiAobXNnLnR5cGUgPT09ICd4aHJTdGFydCcpIHtcclxuICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IG1zZy50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbbXNnLmRhdGEudXJsLCBtc2cuZGF0YS5tZXRob2RdLFxyXG4gICAgICAgICAgICAgICAgICAgIHhock9iamVjdDptc2csXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnLnR5cGUgPT09ICd4aHJEb25lJykge1xyXG4gICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogbXNnLnR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFttc2cuZGF0YS51cmwsIG1zZy5kYXRhLm1ldGhvZCwgbXNnLmRhdGEuc3RhdHVzQ29kZV0sXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyT2JqZWN0Om1zZyxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtNYWlufSBmcm9tICcuL21haW4nO1xyXG5uZXcgTWFpbigpO1xyXG5cclxuIiwiaW1wb3J0IHsgT3BlcmF0b3JNb2RlbCB9IGZyb20gXCIuLi8uLi9zaGFyZWQvc3JjL2xpYi9tb2RlbHMvb3BlcmF0b3JNb2RlbFwiO1xyXG5pbXBvcnQgeyBCcm93c2VyQWN0aW9uTW9uaXRvciB9IGZyb20gXCIuL2Jyb3dzZXJBY3Rpb25Nb25pdG9yXCI7XHJcbmltcG9ydCB7IFhwYXRoSGVscGVyIH0gZnJvbSBcIi4veHBhdGhIZWxwZXJcIjtcclxuaW1wb3J0IHsgUmVxdWVzdGlvbk1vbml0b3IgfSBmcm9tIFwiLi9yZXF1ZXN0TW9uaXRvclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1haW4ge1xyXG4gICAgeHBhdGhIZWxwZXI6IFhwYXRoSGVscGVyO1xyXG4gICAgLy8gdGVtcEV2ZW50RWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgICB0ZW1wRWxlbWVudFZhbHVlOiBzdHJpbmc7XHJcbiAgICByaWdodENsaWNrRWxlbWVudENsaWNrZWQ6IEhUTUxFbGVtZW50O1xyXG4gICAgLy9hY3Rpb25Mb2c6IE9wZXJhdG9yTW9kZWxbXSA9IFtdO1xyXG4gICAgYWN0aW9uTG9nOiB7IHR5cGU6IHN0cmluZywgZGF0YTogT3BlcmF0b3JNb2RlbCB9W10gPSBbXTtcclxuXHJcbiAgICBpc0luaXQ6IHsgc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvciwgc3RhcnRYSFJNb25pdG9yIH0gPSB7IHN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3I6IGZhbHNlLCBzdGFydFhIUk1vbml0b3I6IGZhbHNlIH07XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdpc1N0YXJ0JykgPT09ICd0cnVlJykge1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9Qb3B1cCh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnZ2V0SW5mbycsIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdpc1N0YXJ0ZWQnXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICE9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2lzU3RhcnQnLCAnZmFsc2UnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuaGFzTGlzdGVuZXIodGhpcy5vbk1lc3NhZ2UuYmluZCh0aGlzKSkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKHRoaXMub25NZXNzYWdlLmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoeyB0eXBlOiAnaGVsbG8nIH0pO1xyXG4gICAgfVxyXG4gICAgb25NZXNzYWdlKG1lc3NhZ2U6IGFueSwgc2VuZGVyOiBhbnksIHNlbmRSZXNwb25zZTogYW55KSB7XHJcbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLm1ldGhvZCkge1xyXG4gICAgICAgICAgICBjYXNlICdnZXRVcmwnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ29Ub1VybCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGxvY2F0aW9uLmhyZWYsXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UobG9jYXRpb24uaHJlZilcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdzdGFydEJyb3dzZXJBY3Rpb25Nb25pdG9yJzpcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc1N0YXJ0JywgJ3RydWUnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0WEhSTW9uaXRvcic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0WEhSTW9uaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXNzYWdlIG1ldGhvZCBub3Qgc3VwcG9ydCAtIGFkZCBuZXcgY2FzZSBcIiArIG1lc3NhZ2UubWV0aG9kKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlbmRSZXNwb25zZSh7IHN1Y2Nlc3NmdWw6IHRydWUgfSk7XHJcbiAgICB9XHJcbiAgICBzZW5kTWVzc2FnZShkYXRhOiBPcGVyYXRvck1vZGVsKSB7XHJcbiAgICAgICAgaWYgKCFjaHJvbWUucnVudGltZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmFjdGlvbkxvZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLmFjdGlvbkxvZ1t0aGlzLmFjdGlvbkxvZy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgY29uc3QgaXNQcmV2S2V5cyA9IHByZXYuZGF0YS52YWx1ZSAhPT0gbnVsbCAmJiBwcmV2LmRhdGEudmFsdWUuaW5kZXhPZignS2V5cy4nKSA9PT0gMDtcclxuICAgICAgICAgICAgY29uc3QgaXNDdXJyZW50S2V5cyA9IGRhdGEudmFsdWUgIT09IG51bGwgJiYgZGF0YS52YWx1ZS5pbmRleE9mKCdLZXlzLicpID09PSAwO1xyXG4gICAgICAgICAgICBpZiAocHJldi5kYXRhLnBhdGggPT09IGRhdGEucGF0aCAmJiBwcmV2LmRhdGEuYWN0aW9uID09PSAnc2VuZEtleXMnICYmICFpc1ByZXZLZXlzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzQ3VycmVudEtleXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRVcGRhdGVNZXNzYWdlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgYWN0aW9uID0geyB0eXBlOiAnaW5zZXJ0JywgZGF0YTogZGF0YSB9O1xyXG5cclxuICAgICAgICB0aGlzLmFjdGlvbkxvZy5wdXNoKGFjdGlvbik7XHJcbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvUG9wdXAoYWN0aW9uKTtcclxuXHJcbiAgICB9XHJcbiAgICBzZW5kVXBkYXRlTWVzc2FnZShkYXRhOiBPcGVyYXRvck1vZGVsKSB7XHJcbiAgICAgICAgbGV0IGFjdGlvbiA9IHsgdHlwZTogJ2FwcGVuZExhc3RWYWx1ZScsIGRhdGE6IGRhdGEgfTtcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9Qb3B1cChhY3Rpb24pO1xyXG4gICAgICAgIHRoaXMuYWN0aW9uTG9nLnB1c2goYWN0aW9uKTtcclxuXHJcbiAgICB9XHJcbiAgICBzZW5kTWVzc2FnZVRvUG9wdXAobWVzc2FnZSwgY2FsbEJhY2s/KSB7XHJcbiAgICAgICAgaWYgKGNocm9tZS5ydW50aW1lKSB7XHJcbiAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKG1lc3NhZ2UsIGZ1bmN0aW9uIChyZXNwb25zZTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoISFjYWxsQmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxCYWNrKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhcnRYSFJNb25pdG9yKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzSW5pdC5zdGFydFhIUk1vbml0b3IgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzSW5pdC5zdGFydFhIUk1vbml0b3IgPSB0cnVlO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc0luaXQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmlzSW5pdCkpO1xyXG4gICAgICAgIG5ldyBSZXF1ZXN0aW9uTW9uaXRvcigpLnN0YXJ0TW9uaXRvcih0aGlzLnNlbmRNZXNzYWdlLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG4gICAgc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvcigpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXQuc3RhcnRCcm93c2VyQWN0aW9uTW9uaXRvciA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNJbml0LnN0YXJ0QnJvd3NlckFjdGlvbk1vbml0b3IgPSB0cnVlO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpc0luaXQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmlzSW5pdCkpO1xyXG4gICAgICAgIHRoaXMueHBhdGhIZWxwZXIgPSBuZXcgWHBhdGhIZWxwZXIoKTtcclxuXHJcblxyXG4gICAgICAgIG5ldyBCcm93c2VyQWN0aW9uTW9uaXRvcih0aGlzLnhwYXRoSGVscGVyLCB0aGlzLnNlbmRNZXNzYWdlLmJpbmQodGhpcykpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==